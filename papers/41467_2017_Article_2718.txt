                  ARTICLE
                  DOI: 10.1038/s41467-017-02717-4               OPEN

                  Generalized leaky integrate-and-ﬁre models
                  classify multiple neuron types
                  Corinne Teeter 1, Ramakrishnan Iyer 1, Vilas Menon1,2, Nathan Gouwens1, David Feng 1, Jim Berg1,
                  Aaron Szafer1, Nicholas Cain 1, Hongkui Zeng1, Michael Hawrylycz1, Christof Koch 1 & Stefan Mihalas                                                 1
1234567890():,;




                  There is a high diversity of neuronal types in the mammalian neocortex. To facilitate con-
                  struction of system models with multiple cell types, we generate a database of point models
                  associated with the Allen Cell Types Database. We construct a set of generalized leaky
                  integrate-and-ﬁre (GLIF) models of increasing complexity to reproduce the spiking behaviors
                  of 645 recorded neurons from 16 transgenic lines. The more complex models have an
                  increased capacity to predict spiking behavior of hold-out stimuli. We use unsupervised
                  methods to classify cell types, and ﬁnd that high level GLIF model parameters are able to
                  differentiate transgenic lines comparable to electrophysiological features. The more complex
                  model parameters also have an increased ability to differentiate between transgenic lines.
                  Thus, creating simple models is an effective dimensionality reduction technique that enables
                  the differentiation of cell types from electrophysiological responses without the need for a
                  priori-deﬁned features. This database will provide a set of simpliﬁed models of multiple cell
                  types for the community to use in network models.




                  1 Allen Institute for Brain Science, 615 Westlake Ave N, Seattle, WA 98109, USA. 2 Howard Hughes Medical Institute, Janelia Research Campus, 19700 Helix

                  Dr, Ashburn, VA 20147, USA. Correspondence and requests for materials should be addressed to C.T. (email: corinnet@alleninstitute.org)
                  or to S.M. (email: stefanm@alleninstitute.org)

                  NATURE COMMUNICATIONS | (2018)9:709                      | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                        1
ARTICLE                                                                     NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4




T
        he problem of understanding the complexity of the brain        adding phenomenological complexity to a model inﬂuences its
        has been central to neuroscience. The classiﬁcation of         ability to reproduce neuronal spike times and classify cells.
        neurons into cell types is a conceptual simpliﬁcation             We used a family of models we refer to as generalized leaky
intended to reduce this complexity. To this end, a large-scale         integrate and ﬁre (GLIF) models. This family of models starts
effort at the Allen Institute for Brain Science has focused on         with the classic leaky integrate and ﬁre model13 and then
characterizing the diversity of cell types in the primary visual       incorporates additional phenomenological mechanisms similar to
cortex of the adult mouse using electrophysiology, morphological       other studies. These mechanisms are ﬁt directly from the elec-
reconstructions, connectivity, and modeling in one standardized        trophysiological data and loosely represent slow activation/inac-
effort. This has resulted in the Allen Cell Types Database1 that is    tivation of voltage-gated ion channels and long-term effects of ion
publicly and freely available at http://celltypes.brain-map.org. It    channel currents. Although there are many simpliﬁed and com-
includes both morphological and electrophysiological data of           putationally compact models14 available in the literature, the
genetically identiﬁed neurons mapped to the common coordinate          GLIF framework has a combination of advantages ideal for this
framework2. Morphologically and biophysically detailed as well as      study. First, GLIFs have been shown to be able to recreate a wide
simple generalized leaky integrate-and-ﬁre point neuron models         variety of biologically realistic behavior15. Second, the dynamical
have been generated1 to reproduce cellular data produced under         equations of the GLIF model are linear, and various versions have
highly standardized conditions.                                        been previously ﬁt to biological data15–20. In addition, phenom-
   Creating simpliﬁed models is a way to reduce the complexity of      enological mechanisms loosely representing real biological
the brain to its most fundamental mechanisms. In addition to the       mechanisms can be added to the LIF model that can easily be
beneﬁts of clarifying mechanisms for single-neuron behavior,           interpreted and potentially could be mapped to biological
single-neuron models can be used in larger network models that         mechanisms. Other simpliﬁed non-linear models such as those of
attempt to explain network computation. Thus, many models of a         Izhikevich21,22 can be difﬁcult to ﬁt to data23 and are less phe-
wide range of complexity have been developed to describe and           nomenologically interpretable. Furthermore, Mensi et al.19 have
recreate various aspects of neuronal behavior3. For an in-depth        shown the potential of GLIF models to classify cell types by
characterization of the diversity of neuron models, see the            identifying three cortical neuronal types using a linear classiﬁer.
review4, and for their capacity to reproduce spike times see ref. 5.      Here we expand on previous work, and apply GLIF-ﬁtting tools
   At the high end of the complexity spectrum, are the mor-            to a large-scale database of neuronal responses and demonstrate
phologically and biophysically realistic Hodgkin–Huxley-like           the striking ability of GLIF models to both reproduce spiking
models6–8. Their strength lies in their capacity to map between        behavior and classify a wide variety of transgenic lines. We show:
multiple observables: morphology, electrophysiology, intracellular     (1) The traditional LIF model (GLIF1) was able to reproduce 70%
calcium concentration, and levels of expression and patterns of        of the spike times within a resolution of 10 ms on an in vivo-like
distributions of ionic currents. Although adding complexity to a       stimulus for a large set of biological neurons. Including additional
model may increase the ability of that model to recreate certain       mechanisms increased the ability of the models to recreate spike
behavior, ﬁnding the right parameters for complex models               times by almost 10%. (2) Inhibitory neurons can be better ﬁt than
becomes a challenge9. Furthermore, the computational power             excitatory neurons, and we present evidence that inhibitory
needed to simulate sophisticated neural models can be quite            neurons are more stereotypical than excitatory neurons. (3)
large10. Therefore, ideally one would use a computationally            Inhibitory and excitatory models require different mechanisms to
minimal model adequate to recreate and to understand the               achieve the spike trains of neurons. (4) Increasing model com-
desired behavior11. One simpliﬁcation that signiﬁcantly reduces        plexity by adding mechanisms ﬁt from the voltage waveform does
model complexity is to represent the entire dendritic tree, soma,      not necessarily lead to increased performance in spiking behavior.
and axonal hillock by a single compartment, while maintaining          Furthermore, mechanisms that do not increase performance
the dynamics of the individual conductances3. This approxima-          independently can provide additional beneﬁt when combined
tion is especially warranted when characterizing neurons via           with other mechanisms. (5) Parameters obtained from ﬁtting
somatic current injection and voltage recording as is done in the      neurons with GLIF models are useful in classifying cell types:
Allen Cell Types Database.                                             higher level GLIF parameters are more effective at differentiating
   Here we report on the point neuron modeling portion of the          cell types associated with transgenic lines than sub-threshold
Allen Cell Types Database1. In this study, we aimed to identify        electrophysiological features. (6) GLIF parameters can be com-
simple models that could both effectively reduce the biological        bined with spike-shape features for cell type classiﬁcation.
space to a set of useful parameters for cell type classiﬁcation and       We provide a large-scale database of point neuron models for
recreate spiking behavior for a diverse set of neurons for use in      16 transgenic lines. We characterize the parameters of the GLIF
network models. In the adult cortex, the majority of commu-            models associated with the different transgenic lines and illustrate
nication between neurons is via chemical synapses from axons           the neurons that best recreate the actual spike trains for each of
onto dendritic or somatic membrane (with a fraction of inhibi-         the transgenic lines.
tory neurons coupled by gap junctions as notable exceptions).
The response of these non-NMDA synapses is generally depen-
dent only on the action potentials generated by the presynaptic        Results
cell. Thus, we focus on reproducing the temporal properties of         Model description. In GLIF models, the mechanisms are sepa-
spike trains using computationally compact point neuron models.        rated by time scale: GLIF models aim to represent the slow linear
This spike-train focus allows us to generate models which are          sub-threshold behavior of a neuron and recreate the spike times,
much simpler than biophysically detailed models but still capture      not the shape of the action potential caused by fast, non-linear ion
a substantial amount of their complexity.                              channels. Thus, none of the fast, non-linear processes associated
   An extensive amount of work has gone into constructing              with the action potential itself are included directly in the
simple models that can accurately reproduce the spiking behavior       dynamics. However, some attributes of the spike, such as spike
of neurons5. Yet many large network modeling papers use tra-           width and voltage after a spike relative to voltage before a spike,
ditional leaky integrate and ﬁre models (for example, ref. 12). We     are accounted for in the reset rules which map the state before the
wanted to understand how much may be gained (or lost) in               spike to the state thereafter (Supplementary Methods “Parameter
adding complexity to such models. Thus, we characterized how           ﬁtting and distributions” and Supplementary Fig. 1). Model

2                         NATURE COMMUNICATIONS | (2018)9:709                 | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                         ARTICLE

 Table 1 Description of model parameters and variables

 Variables
 Mechanism             Symbol            Variable
                       VðtÞ              Membrane potential
 ASC                   Ij ðtÞ            After-spike currents
 reset                 Θs ðtÞ            Spike-dependent threshold component
 adapt. th.            Θv ðtÞ            Voltage-dependent threshold component
 Parameters
 Mechanism             Symbol            Parameter                                               Fit from                         Post hoc opt
                       C                 Capacitance                                             Sub-threshold noise              No
                       R                 Membrane resistance                                     Sub-threshold noise              No
                       EL                Resting potential                                       Resting V before noise           No
                       Θ∞                Instantaneous threshold                                 Short square input               Yes
                       δt                Spike cut length                                        All noise spikes                 No
 reset                 fv                Voltage fraction following spike                        All noise spikes                 No
 reset                 δV                Voltage addition following spike                        All noise spikes                 No
 reset                 bs                Spike-induced threshold time constant                   Triple short square              No
 reset                 δΘs               Threshold addition following spike                      Triple short square              No
 ASC                   δIj               After-spike current amplitudes                          Supra-threshold noise            No
 ASC                   kj                After-spike current time constants                      Supra-threshold noise            No
 ASC                   fv                Current fraction following spike                        Set to 1                         No
 adapt. th.            av                Adaptation index of threshold                           Prespike V supra-thr. noise      No
 adapt. th.            bv                Voltage-induced threshold time constant                 Prespike V supra-thr. noise      No


equations can be found in the “Methods” section of the main text             The GLIF4 model incorporates both reset rules of GLIF2 and
and the Supplementary Methods. Table 1 summarizes the model                the after-spike currents of GLIF3.
parameters and variables.                                                    Finally, slow depolarization can lead to partial inactivation of
   The family of GLIF models is schematized in Fig. 1a. Examples           the voltage-dependent sodium current which generates a spike. In
of model behavior are shown in Fig. 1b. A standard LIF model               GLIF5 we incorporate this mechanism into an adapting threshold
was our starting point, progressing to more generalized leaky              (AT) which is dependent on the membrane potential (see
integrate-and-ﬁre models. In the standard LIF model (GLIF1                 “Parameter descriptions” in the Supplementary Methods).
here), current injected into the cell causes the voltage to rise in a        Note that the number of variables increases from one (V(t)) for
linear fashion. When the voltage reaches a ﬁxed threshold                  GLIF1 to two (V(t), Θs ðtÞ) for GLIF2, etc., up to ﬁve for GLIF5 (see
(referred to as Θ∞ here) the model spikes and the threshold is             Table 2).
reset to the resting potential of the neuron.
   The GLIF2 model advances the GLIF1 model by incorporating               Data. Intracellular electrophysiological recordings were carried
more realistic reset rules (R) for voltage and threshold. The rapid        out via a highly standardized process24. The data can be accessed
changes of the action potentials are followed by slower dynamics           in the Allen Cell Types Database1. The data considered here
which affect a neuron’s state. The voltage after a spike does not          consists of in vitro electrophysiology data collected from 16 dif-
reset to rest and the threshold does not remain at a ﬁxed value.           ferent labeled Cre-positive transgenic lines selective for different
This GLIF2 model continues to assume that the spikes are                   types of neurons. The transgenic line panel of Fig. 2 summarizes
sufﬁciently similar such that a mapping between the voltage and            the properties of the different transgenic lines. Colors and short
threshold state before and after a spike can be found. The speciﬁc         hand names represent all transgenic line data throughout this
linear relationship of the voltage after the spike as a function of        manuscript. In general, shades of red represent inhibitory trans-
the voltage before the spike is found directly from the                    genic lines and shades of blue represent excitatory lines. Excita-
electrophysiological data (Supplementary Fig. 1). This relation-           tory neurons from each layer are identiﬁed using layer-selective
ship also deﬁnes the width of a spike or the “refractory period”           lines. For inhibitory neurons, cells are targeted across lamina
which is implemented as a time in which the model cannot                   using lines selective for known neuronal subtypes25. Cells from
produce another spike. In addition to the refractory period, it is         each of the three major inhibitory subtypes (Pvalb (primarily
often more difﬁcult to cause a neuron to spike again after a ﬁrst          basket cells), Sst (primarily Martinotti cells), and Htr3a (diverse
spike due to mechanisms such as the slow inactivation of voltage-          morphologies)) are represented. Also included are transgenic
dependent currents which activate during the spike. This                   lines that enrich for subsets of inhibitory types: the Vip, Ndnf,
difﬁculty in causing another spike is modeled as a rise in                 and Chat Cre lines (subtypes of Htr3a), Chrna2 (subtype of Sst),
threshold that decays after the spike and is again extracted               and Nkx2.1 (subtype of Pvalb). All cell types recorded are from
directly from the data (Supplementary Fig. 3).                             young adult (P45 to P70) C57BL/6J mouse primary visual cortex.
   Although GLIF models do not aim to recreate the shape of an
action potential caused by fast non-linear ion channel activation,
the GLIF3 model does incorporate the longer term effects of ion            Model performance. After model ﬁtting and optimization
channels. Here we assume that ion channel currents have a                  (see Supplementary Methods for details; see Fig. 3 for distribu-
stereotyped activation following a spike, and we bundle all slow           tions of the ﬁt parameters) on our set of training stimuli (Fig. 2;
ion-channel effects into a set of two after-spike currents (ASC)           see the “Stimulus” section of the Methods for details), we test
with different time scales. These currents are again ﬁt directly           model performance on a “hold out” in vivo-like noise stimulus
from the data (see “Parameter ﬁtting and distributions” in                 not used for training (to ensure our models were not over ﬁt).
the Supplementary Methods).                                                Using hold-out data to evaluate model performance is the “gold
                                                                           standard” for model selection. In the “Akaike Information Cri-
                                                                           terion” section of the Supplementary Methods and

NATURE COMMUNICATIONS | (2018)9:709                  | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                  3
ARTICLE                                                                                                NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4



                               a                                                              After-spike currents (ASC)
                                                                                Ij (t)
                                                                                            Membrane potential reset (R)

                                                       Ie(t)
                                                                               V(t )                               Spike?


                                                                  Threshold
                                                                  adaptation
                                                                                            v (t )
                                                                        (TA)


                                                                                            s(t )
                                                                                                       Threshold reset (R)



                               b
                                                   Htr3a                                                                     Ctgf
                                                                                         Current


                                                                                          Data


                                                                                          GLIF1


                                                                                          GLIF2
                                                                                           R                100 pA                    20 mV
                                                                                                                             100 ms


                                                                                          GLIF3
                                                                                          ASC




                                                                                          GLIF4
                                                                                         R + ASC




                                                                                          GLIF5
                                                                                         R + ASC
                                                                                           + AT


Fig. 1 Five generalized leaky integrate-and-ﬁre (GLIF) models consisting of different phenomenological mechanisms are ﬁt to electrophysiological data. A
schematic describing the mechanisms is shown in a. Example data and models from two neurons of different transgenic lines are shown in b. For all models
the input is a current, Ie ðtÞ, injected via a patch electrode illustrated in black at the top of b. Below the current are the voltage traces from four repeats of the
same stimulus (here colors represent the different responses to the repeated stimuli and do not adhere to the standard color scheme in the rest of the
manuscript). Below the biological data, the GLIF models are plotted. The output of the models is the trans-membrane potential, VðtÞ, pictured in blue.
When VðtÞ reaches a threshold, Θ ¼ Θ1 þ ΘS ðtÞ þ Θv ðtÞ, shown in dashed green, a spike is produced, illustrated by blue dots. Note that the shape of the
spike is not plotted as it is not ﬁt by these models. Instead, after a refractory period, VðtÞ is reset to a value dependent on the speciﬁc model. The GLIF1
model is equivalent to the traditional LIF model with a refractory period where the model can not spike. This model contains one variable, VðtÞ, and the
threshold is ﬁxed to a value we refer to as Θ∞. GLIF2 models include a second variable: a spike-induced threshold ΘS ðtÞ which is added to the baseline
threshold Θ∞. When the model spikes, ΘS ðtÞ, jumps up and then decays. Thus, after a spike, initially the total threshold is higher making it harder for the
model to reach threshold. GLIF3 includes VðtÞ and two variables corresponding to two spike initiated after spike currents, Ij ðtÞ, which have different time
constants and decay back to zero. The sum of the after-spike currents are illustrated in red. GLIF4 combines GLIF2 and GLIF3 for a total of four variables.
GLIF5 includes an additional threshold component Θv ðtÞ. ΘV ðtÞ is dependent on the voltage of the model. Scale bars represent all model plots (not the
amplitude of the current injection or biological voltage traces)

Supplementary Fig. 11, we also provide an Akaike Information                                   1.83e−45. Thus, we continue with Wilcoxon sign-ranked tests
Criterion (AIC) measure (which follows the same trends) to                                     where p-values are corrected for multiple comparisons using the
characterize the trade-off between complexity and model per-                                   Bejamini–Hochberg procedure. All p-values can viewed in Sup-
formance of GLIF models on training data. We quantiﬁed per-                                    plementary Figs. 8, 9, and 10.
formance by how much of the temporal variance in the spike                                        The progression of explained variance through the different
times of the data can be explained by the model at a 10 ms                                     model levels demonstrates that different mechanisms are
temporal scale (see Fig. 4 and “Evaluation of model spike times”                               important for achieving spiking behavior of inhibitory and
in the Supplementary Methods for details). Medians of explained                                excitatory neurons. Overall GLIF1 (equivalent to a leaky integrate
variance of all data can be viewed in Fig. 5 with corresponding                                and ﬁre model) had a surprisingly high explained variance of 70%
values in Table 3. We begin our analysis by testing if there are                               when all neurons were considered. Inhibitory neuron models
overall differences between the GLIF model levels. A Friedman                                  perform better then excitatory models: 75% versus 68%. The
test reports that there are overall differences with a p-value of                              introduction of reset rules in GLIF2 decreases the performance of

4                              NATURE COMMUNICATIONS | (2018)9:709                                        | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                                                                  ARTICLE

 Table 2 Summary of GLIF models and results

                        Num.          Variables                       Model parameters                              Parameters in clustering                                  Explained           Num.
                        cells                                                                                                                                                 variance            clusters
                                                                                                                                                                              Δt = 10 ms
 GLIF1                  645           VðtÞ                            R, C, EL, Θ∞, δt                              R, C, EL, Θ∞, δt                                          70.2%               10
 GLIF2                  254           VðtÞ, Θs ðtÞ                    R, C, EL, Θ∞, δt, fv, δV, bs, δΘs             R, C, EL, fv, δV, Θ∞, δt                                  67.7%               15
 GLIF3                  645           VðtÞ, I1 ðtÞ, I2 ðtÞ            RASC, C, EL, Θ∞, δt, k1, δI1, k2, δI2         RASC, C, EL, Θ∞, δt,δI1 =k1 , δI2 =k2                     72.4%               18
 GLIF4                  254           VðtÞ, Θs ðtÞ I1 ðtÞ, I2 ðtÞ     RASC, C, EL, Θ∞, δt, fv, δV, bs,              RASC, C, EL, Θ∞, δt, fv, δV, δI1 =k1 , δI2 =k2            75.9%               16
                                                                      δΘs, k1, δI1, k2, δI2
 GLIF5                  253           VðtÞ, Θs ðtÞ I1 ðtÞ,            RASC, C, EL, Θ∞, δt, fv, δV, bs,              N/A: additional parameters are not                        77.6%               N/A
                                      I2 ðtÞ, Θv ðtÞ                  δΘs, k1, δI1, k2, δI2, av, bv                 available for all 645 neurons.
 All features           645           N/A                             N/A                                           τm, Ri, Vrest, Ithresh†, Vthresh†, Vpeak†,                N/A                 16
                                                                                                                    Vfasttrough†, Vtrough† up:downstroke†, up:
                                                                                                                    downstroke*, sag, f–I curve slope,
                                                                                                                    latency, max. burst index
 Sub-thr                645           N/A                             N/A                                           τm, Ri, Vrest, Ithresh†, Vthresh†, Vtrough†, sag,         N/A                 16
 features                                                                                                           f–I curve slope, latency, max. burst
                                                                                                                    index
 The “Num. cells” column reports the number of cells for which a model was constructed or the paradigm was clustered. Note that for the GLIF models clustering was only performed on parameters that
 were available for all 645 cells. Therefore, the “Parameters in clustering” list is a subset of the total “Model Parameters” available for any level. The variables for each model level are listed in the
 “Variables” column. Note that resistance was ﬁt along with after-spike currents in models where after-spike currents were implemented. R denotes the resistance ﬁt without ASC and RASC denotes the
 resistance ﬁt along with after-spike currents. GLIF5 does not report clusters because there are no additional parameters available for all 645 neurons, i.e., it would be the same clustering paradigm as in
 GLIF4 as the only new parameters associated with GLIF5 (av and bv) are only ﬁt for the reduced set of cells. We are unable to cluster on the time scales of every after-spike current alone as there were ﬁve
 discrete possible values but only two were chosen for each neuron. Therefore, we cluster on the total charge deposited over short δI1 =k1 and long δI2 =k2 time scales (continuous numbers) for the model
 levels that contain after-spike currents. The average explained variance at a time resolution of 10 ms for all neurons at each level is reported as well as the number of clusters that were found using the
 aforementioned clustering parameters via the hierarchical clustering technique. As in Supplementary Tables 6 and 7, * denotes features measured during a short square stimulus, and † represents
 features measured during a long square stimulus (Fig. 2)



the models for both excitatory (65%) and inhibitory (74%)                                                 (Supplementary Fig. 15), although GLIF2 better reproduces sub-
neurons. The introduction of after-spike currents alone in GLIF3                                          threshold voltage than GLIF1 and GLIF3, it does worse at
helps the inhibitory neurons (81%) but not the excitatory (68%)                                           reproducing the spiking behavior. Thus, the ability of a model to
neurons. To conﬁrm that improvement of ﬁtting between GLIF1                                               reproduce sub-threshold voltage does not necessarily translate
and GLIF3 follow different trends for inhibitory and excitatory                                           into better spike time performance.
neurons, we subtracted the pairwise explained variance ratio of                                              There are several potential methodological and biological
GLIF1 from GLIF3 models. We found that the distributions of                                               explanations for the increased ability to ﬁt inhibitory neurons
these differences for the excitatory and inhibitory neurons                                               over excitatory neurons. It is possible that inhibitory neurons are
are signiﬁcantly different (p = 1.35e−7, Mann–Whitney U;                                                  better optimized because they generally ﬁre more and thus have
Benjamini–Hochberg correction, family size = 10), suggesting                                              more data points to optimize (see the Supplementary Methods for
that after-spike currents have different inﬂuence in inhibitory                                           details). Alternatively, perhaps they are easier to ﬁt because they
and excitatory neurons. Interestingly, the inclusion of reset rules                                       are more stereotypical than excitatory neurons. As described in
with after-spike currents in GLIF4 improves the performance of                                            the “Parameter ﬁtting and distributions” section of the Supple-
both excitatory (72%) and inhibitory neurons (83%) even though                                            mentary Methods and Supplementary Fig. 1, we deﬁne spike cut
reset rules alone hurt performance. Please see the “Discussion”                                           length as the post spike time at which a linear regression based on
section for a discourse on the inﬂuence of model complexity on                                            the voltage before the spike minimizes the squared residuals of
performance. Here again, the distribution of differences between                                          the voltage after the spike. We use the standard error from this
GLIF3 and GLIF4 are statistically different for inhibitory                                                spike cut length ﬁt as a description of spike reproducibility.
and excitatory neurons (p = 2.89e−4, Mann−Whitney U;                                                      Inhibitory neurons have shorter spike cut lengths than excitatory
Benjamini–Hochberg correction, family size = 10). Finally, the                                            neurons (median 2.7 versus 4.6 ms, respectively; p = 1.10e-47,
addition of the adaptive threshold along with the after-spike                                             Mann Whitney U), spike more frequently (a median of 84 versus
currents and reset rules provides an improvement for excitatory                                           38 spikes per noise 1 stimuli, respectively; p = 6.15e-35, Mann
cells (75%) but does little for inhibitory (84%) cells. Distributions                                     Whitney U), and have more reproducible spikes (median
of differences of excitatory and inhibitory neurons differ with the                                       standard error 2.6e−2 and 5.7e−2, respectively; p = 4.97e-39,
following values GLIF3 and GLIF5: p = 1.98e−5, GLIF4 and GLIF5:                                           Mann Whitney U). Supplementary Fig. 4 shows there are
p = 1.40e−2 (Mann−Whitney U; Benjamini–Hochberg correction,                                               correlations between the explained variance ratio for each of
family size = 10).                                                                                        these three variables. To investigate the importance of these
   We found it interesting that the addition of reset rules                                               factors in achieving a good model ﬁt, we perform a multiple linear
measured directly from the data actually hindered the ability of                                          regression (Python, statsmodels.regression.linear_model.OLS).
the GLIF2 model to recreate spike times of the neural data. We                                            Spike cut length and number of spikes are good indicators of
explored if there was a relationship between the ability of a model                                       how well a neuron will be ﬁt (p-values are 2.80e−19 and 5.95e-21,
to reproduce the sub-threshold behavior of the voltage waveform                                           respectively), whereas this measure of spike reproducibility is not
and reproduce the neural spike times. When taking into account                                            statistically important (p-value: 0.276).
all models, overall there is a correlation between the ability of a                                          It is likely that individual transgenic lines will have different
model to reproduce the sub-threshold voltage and its ability to                                           mechanisms most important for achieving their spiking behavior.
reproduce spike times (please see the black regression line in                                            We do not draw any conclusions here due to a large number of
Supplementary Fig. 15). However, when considering the median                                              non-signiﬁcant p-values between model levels for individual
performance values describing the ability of the different model                                          transgenic lines (most likely due to the lower number of neurons
levels to reproduce sub-threshold voltage and spike times                                                 from individual transgenic lines in this study). Performance of

NATURE COMMUNICATIONS | (2018)9:709                                           | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                                                            5
ARTICLE                                                                                    NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4



    Transgenic lines                                                                  Training stimuli
                                                                                      a        ‘Noise1’

                                                                                     AP threshold
          Name            n      E/I      L1     L2/3      L4     L5     L6         310 pA 110 pA

       All neurons       645     E/I      X        X       X      X      X
                                                                                          Htr3a
       Inhibitory        283       I      X        X       X      X      X
       Excitatory        362      E                X       X      X      X
      Scnn1a-Tg2          22      E                        X                            Ctgf

      Scnn1a-Tg3          37      E                        X      X
         Nr5a1            47      E                        X
         Rorb             88      E                        X      X
                                                                                                  b   ‘Supra-threshold   c        ‘Sub-threshold   d    ‘Triple short
                                                                                                        short square’              long square’           square’
         Cux2             56      E                X       X                                   650 pA                    290 pA                    650 pA
                                                                                               830 pA                     90 pA                    830 pA
         Ntsr1            39      E                                      X
          Ctgf            20      E                                      X
         Rbp4             53      E                               X
          Sst             64       I               X       X      X      X
         Pvalb            53       I               X       X      X      X
         Htr3a            62       I      X        X       X      X
                                                                                      Test stimuli
         Ndnf             15       I      X
                                                                                      e        ‘Noise2’
         Chat             18       I               X       X      X      X            AP threshold
                                                                                    310 pA 110 pA
          Vip             19       I               X       X      X      X
        Chrna2            29     E/I                       X      X
        Nkx2.1            23       I               X       X      X      X




Fig. 2 Overall, 645 different neurons from 16 transgenic lines containing all the required stimuli on the Allen Cell Types Database are considered in this
study. (Left) Illustrated colors correspond to the different transgenic lines in all ﬁgures. “n” describes the number of neurons for which the lowest level
model (GLIF1) could be generated. Transgenic lines can identify either or both inhibitory (I) or excitatory (E) cells, which reside in layer 1 (L1) through layer
6 (L6). Note that most Chrna2-Cre-positive neurons are inhibitory and thus are labeled here as inhibitory. (Right) A minimal set of stimuli were required for
training and testing different GLIF models. GLIF models were trained using a at least two repeats of pink noise stimuli (3 s each, 1/f distribution of power,
1 – 100 Hz) with amplitudes centered at 75, 100, and 125 percent of action potential threshold, b a short (3 ms) just supra-threshold pulse to ﬁt the
instantaneous threshold, Θ∞, c a long square (1 s) pulse just below threshold to estimate the intrinsic noise present in the voltage traces (used in the post
hoc optimization step), and d a series of three peri-threshold short pulse sets for any model with reset rules (GLIF2, GLIF4, and GLIF5). GLIF models were
then tested using a hold-out stimulus set e of at least two sweeps of a second pink noise stimuli generated in an identical manner to the training but
initialized with a different random seed. Representative data shown from an Htr3a-Cre-positive neuron (resting membrane potential (RMP) −67 mV) and a
Ctgf-Cre-positive neuron (RMP = −74 mV). Scale bar in a corresponds to 40 mV (a, e), 50 mV (b, d), or 20 mV (c)

individual transgenic lines can be viewed in Fig. 5 with                          other good representative models, neurons that contain all GLIF
corresponding values in Table 3 and Supplementary Figs. 9 and 10.                 model levels and all model parameters within the 5 to 95
                                                                                  percentiles are available in Supplementary Table 1.

Example neurons. Throughout the manuscript data and models
from two exemplary neurons are consistently shown as examples:                    Clustering. After deriving parameters for each of the GLIF
an Htr3a inhibitory neuron (specimen ID 474637203) and a Ctgf                     models, we assessed how well these parameters could classify
pyramidal neuron (specimen ID 512322162).                                         neurons into putative types corresponding to transgenic lines. We
   To provide examples of models that do well reproducing the                     used two different clustering algorithms to identify trends that
spike times of the different transgenic cell lines, for each line we              were not method-speciﬁc. The ﬁrst of these is an iterative binary
select the model which has the highest explained variance from                    splitting method, using standard hierarchical clustering methods
neurons that have all ﬁve model levels. Example neurons are                       (see the “Clustering” section of the Supplementary Methods for
labeled with stars in all ﬁgures and can be found on the website                  details) to separate cells into groups in an iterative manner. We
via the following specimen IDs: Nr5a1: 469704261 GLIF5, Cux2:                     show the results of the hierarchical clustering here in Figs. 6
490376252 GLIF4, Ctgf: 512322162 GLIF5, Vip: 562535995 GLIF5,                     and 7. We conﬁrm the general trends from this analysis using a
Scnn1a-Tg2: 490205998 GLIF5, Ntsr1: 490263438 GLIF4, Sst-                         second clustering method, afﬁnity propagation26, as shown in
IRES: 313862134 GLIF4, Rbp4: 488380827 GLIF5, Scnn1a-Tg3-                         Supplementary Figs. 12 and 14.
Cre: 323834998 GLIF3, Chrna2: 580895033 GLIF2, Pvalb:                                To compare different partitions of the cells, we use the adjusted
477490421 GLIF4, Ndnf: 569623233 GLIF5, Nkx2.1: 581058351                         Rand index (ARI)27 and the adjusted variation of information
GLIF5, Htr3a: 474637203 GLIF5, Chat: 518750800 GLIF5, Rorb:                       (AVOI) metric28. The adjusted Rand index is a corrected-for-
467003163 GLIF3. Although these neurons are the best                              chance extension of the Rand Index, which measures the
performers, they may not be the most representative cells. Most                   probability that any pair of elements will belong to the same
of these models have at least one parameter which lies outside the                cluster in different partitionings. A value of 1 indicates that the
5 to 95 percentiles for the trangenic line. To facilitate the choice of           data clusterings are exactly the same, whereas a value of 0

6                              NATURE COMMUNICATIONS | (2018)9:709                             | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                                                                            ARTICLE

                      a                                                                                             b

                                             50                                                                                        2.5
                                             45
                                                                                                                                       2.0


                        Measured ΔV∞ (mV)
                                             40




                                                                                                                      Slope (mV/mS)
                                             35                                                                                        1.5
                                             30
                                                                                                                                       1.0
                                             25
                                             20                                                                                        0.5
                                             15
                                                                                                                                       0.0
                                             10
                                              5                                                                                       –0.5
                                              –90 –85 –80 –75 –70 –65 –60 –55                                                                1   2   3        4    5    6    7    8       9   10
                                                               Resting potential (mV)                                                                    Spike cut length (ms)

                      c                                                                                             d


                                         300                                                                                            6
                                                                                                                                        4
                                         250
                                                                                                                                        2
                                         200
                                                                                                                                        0




                                                                                                                    Q2 (pC)
                       C (pF)




                                         150                                                                                           –2
                                                                                                                                       –4
                                         100
                                                                                                                                       –6
                                             50
                                                                                                                                       –8
                                             0                                                                                        –10
                                                  0       10       20        30    40   50      60                                       –12 –10         –8       –6    –4   –2       0       2
                                                                          (ms)                                                                                   Q1 (pC)

                      e                                                                                             f


                                         100                                                                                           3.5
                                                                                                                                       3.0
                                             80
                                                                                                                                       2.5
                       1/bs (ms)




                                                                                                                        log10 (bv)




                                             60                                                                                        2.0

                                             40                                                                                        1.5
                                                                                                                                       1.0
                                             20
                                                                                                                                       0.5
                                              0                                                                                        0.0
                                                  0   2        4   6     8    10 12 14 16 18                                             –0.2–0.1 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7
                                                                        Θs (mV)                                                                                   av /bv


Fig. 3 Slices from the parameter space ﬁt from electrophysiological data. Detailed parameter ﬁtting methodology (Fig. 2) is available in the Supplementary
Methods. Stars denote example neurons listed in the main text. a Resting potential is measured as the average voltage during rest before training noise
(noise 1) current is injected. The threshold relative to rest, ΔV, is measured by subtracting resting voltage from the threshold obtained from the supra-
threshold short square pulse. b The spike waveform is removed from the voltage trace by aligning all spikes and ﬁtting a line to the voltage before and after
a spike. The best ﬁt line within a window of 10 ms after spike initiation was chosen (Supplementary Fig. 1). This spike cut length is used in all models, and
voltage measurements before and after a spike are used to reset voltage in (GLIF2, GLIF4, and GLIF5). c Capacitance and resistance are ﬁt via linear
regression to sub-threshold voltage (Supplementary Fig. 2). The membrane time constant, τ = RC is plotted. d Total charges of the fast, Q1, and slow, Q2,
after-spike currents deposited each time there is a spike. e The amplitude, as, and decay, bs, of the spiking component of the threshold, Δs, (used in GLIF2,
GLIF4, and GLIF5) is ﬁt to the triple short square data set (Supplementary Fig. 3). f In the GLIF5, the threshold is inﬂuenced by the voltage of the neuron
according to (Equation 4). The two parameters of Eq. 4 are plotted here. Colors in all panels correspond to transgenic lines illustrated in Fig. 2


indicates that the clusterings are no different from what would be                                                 in the “Stimulus” section of the Methods, GLIF2, GLIF4, and
expected by chance. The AVOI metric is an information-theoretic                                                    GLIF5 require a stimulus that is not applied to all neurons (for
value measuring the ability of one partitioning to predict the                                                     reasons independent of this study). To ensure a full data set for
other, as compared to shufﬂed-label data. A value of 0 indicates                                                   clustering, we use only parameters that are available for all 645
that the clusterings are no different from what would be expected                                                  cells. Table 2 describes the parameters used in each clustering
by chance. The upper bound on the AVOI is dependent on the                                                         paradigm.
number of elements in the clustering. Here the upper bound is                                                         First, we assess how well the putative clusters agree with known
6.47. We show the ARI and AVOI from the hierarchical                                                               cell type information based on the transgenic lines from which
clustering in the main text (Figs. 6 and 7). We show results from                                                  the cells were derived. This is an imperfect validation as it is
afﬁnity propagation in the Supplementary Figs. 12 and 14. The                                                      known that different transgenic lines may not perfectly
variability in the performance of the binary splitting method via                                                  correspond to different cell types, as measured by transcrip-
bootstrapping is shown in Supplementary Fig. 17. As mentioned                                                      tomics25. The ARI and AVOI values for Cre lines compared to

NATURE COMMUNICATIONS | (2018)9:709                                                          | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                                     7
ARTICLE                                                                                                             NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4



            a                                                                Medium amplitude                                         High amplitude




                                                 Data
            Htr3a


                                            GLIF1
                                            GLIF2
                    Model


                                            GLIF3
                                            GLIF4
                                            GLIF5
                                                 Data




                                           GLIF1
            Ctgf
                    Model




                                           GLIF2
                                           GLIF3
                                           GLIF4
                                           GLIF5

            b                                                        GLIF1                 GLIF2            GLIF3                 GLIF4                 GLIF5


                                                       100
                        Htr3a




                                                        90
                                % Explained variance




                                                        80
                                                        70
                                                        60


                                                       100
                        Ctgf




                                                        90
                                                        80
                                                        70
                                                        60
                                                             0   5   10 15 20 0        5   10 15 20 0   5   10 15 20 0        5   10 15 20 0        5   10 15 20
                                                                                                        Time (ms)

Fig. 4 Rastergrams and explained variance of biological data and all optimized model levels for “hold out” test data. a Data for the two example cells.
Injected current shown in black. Black rasters are spikes from recorded neurons to repeated current injections. Colored rasters correspond to the ﬁve
different, deterministic models. The current injection is 3 s long. As GLIF1 and GLIF2 do not have a spike frequency adaptation mechanism (implemented by
the summation of after-spike currents over many spikes in GLIF3), they have trouble reproducing simultaneously the ﬁring patterns at multiple input
amplitudes. b Explained variance for the different model levels at different levels of time window resolution Δt. The black lines represent the explained
variance of the data (how well the neuron repeats its own spiking behavior). This trace would reach 100% if the spike times of the data were all exactly at
the same time in each repeated stimulus: the fact that they are not 100% reﬂects the intrinsic variation in the spike times within the experimental data. The
blue line illustrates the pairwise explained variance of the model with the data. Because the model can not be expected to explain the data better than the
data can explain itself, the red line is the ratio of the pairwise explained variance of the model (blue) and the data divided by the explained variance of the
data (black). This ratio value at a Δ t = 10 ms time bin is used for the explained variance performance metric in the main text

transcriptomics found in a previous study25, are 0.30 and 2.69,                                             values calculated during afﬁnity propagation are higher for GLIF3
respectively (AVOI upper bound was 6.86 in the cited study).                                                and GLIF4 than for GLIF1 and GLIF2 (Supplementary Fig. 12).
Nonetheless, we would expect some degree of relationship, as                                                   The transgenic line composition of each terminal cluster in
broad classes of cells do tend to segregate by transgenic line.                                             GLIF4 (Fig. 6) suggests that clustering based on model parameters
Second, to further validate our results, we compare the clustering                                          broadly segregates neurons into previously identiﬁed classes of
obtained by GLIF parameters to the clustering obtained using                                                cells. Neurons from transgenic lines labeling predominantly
features extracted directly from electrophysiological traces. Here                                          excitatory neurons cluster separately from those labeling mainly
we use two sets of features. In the ﬁrst set, we cluster on 14                                              interneurons. In addition, sub-categories of neurons appear: these
features that contain aspects of both sub-threshold and supra-                                              include parvalbumin-positive interneurons, layer 6a corticotha-
threshold spike-shape features. As GLIF neurons do not recreate                                             lamic neurons (derived from the Ntsr1 transgenic line), and layer
the shape of a spike, in the second set we start with the same set of                                       6b neurons (derived from the Ctgf transgenic line).
features but eliminate all features that describe the shape of the                                             When the same hierarchical clustering technique is applied
action potential. See the “Electrophysiological features” section for                                       directly to the electrophysiological feature data set that includes
a brief description of the features used here; a more detailed                                              spike-shape parameters (bottom left of Fig. 6 and Supplementary
description can be found in ref. 24                                                                         Fig. 14), the correspondence between electrophysiological clusters
   The progression of the ability of the GLIF model parameters to                                           and transgenic lines is similar to those of GLIF4 parameter-based
recapitulate segregation of cells by transgenic line is shown in                                            clusters (the electrophysiological cluster scores higher than GLIF4
Fig. 6. Figure 6 quantiﬁes how clustering the different GLIF level                                          when using iterative binary clustering (Fig. 6) and lower when
parameters improves the distinction among different transgenic                                              using afﬁnity propagation (Supplementary Fig. 12). However,
lines. Although GLIF1 and GLIF2 have an ARI of ~0.08 (AVOI                                                  when the features describing the spike shape of the neuron are
~0.8), GLIF3 ARI increases to ~0.12 (AVOI ~1.3) and GLIF4                                                   removed, the ARI drops below GLIF4 to a value similar to GLIF3
improves even more yielding a value of ~0.18 for the iterative                                              (Fig. 6). Thus, the dimensionality reduction onto the space of
binary clustering (AVOI ~1.3). Similarly, the ARI and AVOI                                                  model ﬁt parameters allows for discriminability better than that

8                                                            NATURE COMMUNICATIONS | (2018)9:709                     | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                        ARTICLE

                              100                                                          the information contained in this set of sub and supra-threshold
                                                                                           electrophysiological features.

                              90
% Median explained variance




                                                                                           Discussion
                                                                                           In the cerebral cortex there is a wide diversity of neuron types
                              80                                                           observed at transcriptomic levels25. The existence of different
                                                                                           types may be driven by a need to develop particular cell type-
                                                                                           speciﬁc connectivity, neuromodulation, or perform different cell
                              70                                                           speciﬁc computations, as well as by developmental and evolu-
                                                                                           tionary constraints. When constructing a system-level model, it is
                                                                                           important to know how many types of neurons are needed.
                              60                                                              We provide a sizable database of GLIF models that can facil-
                                                                                           itate the development of system models with cell types available
                                                                                           in the Allen Cell Types Database at http://celltypes.brain-map.
                              50                                                           org/. Here we show that GLIF models can simultaneously
                               GLIF1   GLIF2        GLIF3         GLIF4         GLIF5      reproduce the spike times of biological neurons and reduce the
                                                                                           complex mapping between the input current to the spike-train
                                               GLIF model level
                                                                                           output with a small number of parameters. We explore how
Fig. 5 Different mechanisms improve model performance for inhibitory and                   complexity affects the ability of models to both reproduce spike
excitatory neurons. The traditional leaky integrate and ﬁre model (GLIF1)                  times and differentiate transgenic lines via unsupervised cluster-
yielded surprisingly high model performance. Overall, inhibitory models                    ing. We ﬁnd that the more complex models (GLIF3 or greater) are
were more successful at reproducing spike times than excitatory models.                    better than the less complex models at reproducing biological
Reset rules implemented on their own (GLIF2) decreased model                               spike times and differentiating transgenic lines.
performance. After-spike currents (GLIF3) improved inhibitory model                           After optimizing the neuronal parameters, we were surprised at
performance, whereas a combination of both after spike currents and reset                  how well the traditional leaky integrate and ﬁre neuron models
rules (GLIF4) were required to gain performance of excitatory models. The                  reproduce spike times under naturalistic conditions, explaining a
voltage-dependent adapting threshold (GLIF5) improved performance of                       median value of 70.2% of the variance. To put this value in
excitatory models even more, but had only a slight effect on inhibitory                    context, biophysically realistic models with passive dendrites in
models. The thick blue line denotes all excitatory neurons, the thick red line             the Allen Cell Types Database1 achieve a median explained var-
denotes all inhibitory neurons, and the thick black line is for all neurons.               iance of 65.1% (n = 195) and biophysically realistic models with
Thin lines are different transgenic lines. Accompanying data is available in               active dendrites achieve a median explained variance of 69.3% (n
Table 3. p-values for signiﬁcant differences between GLIF model levels can                 = 107). It should be noted that the biophysical models are not
be found in Supplementary Figures 8, 9, and 10. Brieﬂy, for the “all”,                     optimized to reproduce spike times but instead to recreate other
“excitatory”, and “inhibitory” groupings the p-values are smaller than 0.01                aspects of electrophysiological responses8,29. As we show with
(and often much smaller) for all but between the excitatory GLIF2 and GLIF3                GLIF2, ﬁtting data to aspects of the voltage waveform does not
(Supplementary Fig. 8). Differences between GLIF levels of different                       mean that the ability of the models to reproduce spike times will
transgenic lines are sometimes statistically signiﬁcant and sometimes not                  improve.
(Supplementary Figures 9 and 10)                                                              Our result that a model’s ability to reproduce sub-threshold or
                                                                                           spiking behavior does not increase monotonically with model
                                                                                           complexity may seem counterintuitive. Furthermore, we
obtained by the extraction of a subset of electrophysiological                             demonstrate that the overall ability of a model level to reproduce
features without spike shape.                                                              sub-threshold behavior does not translate into the overall ability
   Similarly, when we compare how well the GLIF parameter                                  of a model level to reproduce spike times. When trying to
clustering matches the full feature-based clustering (Fig. 7,                              understand how this is possible, it is important to note several
bottom right), GLIF1 and GLIF2 parameter-based clustering                                  things. Theoretically, in a situation where all parameters are
results in partitions that are dissimilar from that obtained using                         simultaneously optimized, increasing complexity (via the addition
the electrophysiological features. GLIF3 and GLIF4 parameter-                              of new mechanisms and variables to the previous model) should
based clustering results in partitions that are closer to that                             lead to a smaller error of the function being minimized. In this
obtained with the full-feature clustering. The set of partitions                           paradigm, one could include more parameters or state variables
obtained by the non-spike electrophysiological features are the                            until the model starts to over ﬁt the training data. Optimizing on
most similar to the partitions obtained from the full set of                               our performance metric of explained variance would no longer be
electrophysiological features. This is not surprising as the non-                          convex, and hence, optimization would be more unintuitive and
spike features are a subset of the full set of features. Confusion                         computationally intensive with no guarantee of convergence. We
matrices of the relationship between electrophysiological feature-                         chose a different route, in which different observables and error
based clustering and GLIF parameter-based clustering are shown                             functions are used to isolate the effects of individual mechanisms.
in Supplementary Fig. 13.                                                                  For example, here we optimize the difference in voltage between
   We performed clustering on the GLIF parameters and the spike                            the model and the data during the forced spike paradigm because
features to determine whether combining them would further                                 this is a convex problem. What we desired was a “good” model
help the differentiation of Cre lines (Fig. 7 and Supplementary                            that has mechanisms which relate to how the neuron is actually
Fig. 14). Including spike-shape features along with GLIF1 and                              performing computations and thus recreates observed behavioral
GLIF2 parameters greatly increases their ability to differentiate                          aspects such as sub-threshold voltage and spike times. In our
Cre lines. For the more complex neuronal models, the                                       study, the following procedures could lead to the observed non-
improvement of including the spike features is modest, suggesting                          monotonic behavior. (1) Individual mechanisms are not opti-
that the GLIF3 and GLIF4 model parameters encompass most of                                mized to reproduce the spike times, but rather to ﬁt different
                                                                                           aspects of the sub-threshold membrane potential during different

NATURE COMMUNICATIONS | (2018)9:709                                  | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                9
ARTICLE                                                                                                         NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4



 Table 3 Explained variance of all model levels after post hoc optimization

                            n                GLIF1                           GLIF2                           GLIF3                           GLIF4                           GLIF5
 All                        645              70.2 (43.8, 93.7)               67.7 (47.4, 90.5)               72.4 (40.7, 95.3)               75.9 (46.8, 96.5)               77.6 (49.4, 96.5)
 Inhibitory                 283              74.7 (41.7, 95.6)               73.6 (45.5, 93.8)               80.7 (42.6, 97.2)               83.3 (52.1, 97.5)               84.1 (52.3, 97.3)
 Excitatory                 362              68.0 (47, 81.6)                 65.2 (49.5, 75.2)               67.5 (39.8, 86.9)               72 (46.2, 88)                   74.8 (46.6, 89.1)
 Scnn1a-Tg2                 22               62.2 (39.6, 74.4)               63.8 (52.3, 70.5)               56.5 (36, 74.8)                 62.9 (38, 72.8)                 64.9 (37.5, 75.3)
 Nr5a1                      47               67.7 (50.8, 80.1)               66.4 (61.6, 76.3)               70.1 (46.3, 85.7)               74.6 (49.4, 85.6)               76.3 (57, 86)
 Scnn1a-Tg3                 37               66.6 (49.7, 79)                 67.8 (56.4, 80.1)               58.6 (42.2, 89)                 65.7 (39.9, 88.5)               63.4 (48.2, 88.6)
 Rorb                       88               67.5 (46.4, 81.1)               67.6 (56.9, 77.2)               67 (39.1, 86.5)                 71.2 (51.3, 85.2)               72.2 (50.7, 87)
 Cux2                       56               70.5 (59.1, 82.2)               67.3 (53.4, 75)                 73.2 (42.9, 86.3)               75.7 (56.1, 87.7)               75.7 (60, 87.6)
 Ntsr1                      39               70.2 (52.1, 80.4)               57.7 (38.4, 68.7)               79.4 (55.4, 88.4)               79.9 (69.2, 91.1)               83.2 (69.2, 91.6)
 Ctgf                       20               60.4 (34.9, 74.2)               56.0 (44.2, 66)                 52.9 (33.5, 78)                 52.4 (38, 78.4)                 63.6 (33.7, 81.3)
 Rbp4                       53               70.2 (49.6, 85.1)               64.1 (52.5, 73.8)               68.3 (43.5, 86.5)               75.8 (53.8, 87.2)               77.5 (58.2, 88.1)
 Sst                        64               75.1 (32.2, 93.5)               75.4 (46, 90.9)                 77.3 (37, 95.8)                 77.2 (51.7, 95.8)               78.1 (49.3, 95.7)
 Pvalb                      53               93.1 (32.4, 96.9)               89.5 (43.4, 96.3)               95.3 (34.6, 97.6)               96.9 (53.2, 98.5)               96.7 (54.9, 98.6)
 Htr3a                      62               70.9 (49.6, 83.2)               63.8 (45.5, 80)                 83.1 (49.2, 94)                 83.5 (57.7, 94)                 85.6 (64.7, 93.9)
 Ndnf                       15               83.4 (59.3, 93)                 76.2 (55, 83.1)                 89.8 (58.2, 92.6)               90.5 (60, 94.4)                 90.7 (65.9, 94.2)
 Chat                       18               65.8 (44.2, 80.7)               NaN                             75.7 (43.6, 85.3)               NaN                             NaN
 Vip                        19               69.3 (41.7, 85.3)               67.7 (50.8, 72.7)               76.2 (52.6, 89.3)               77.1 (62.8, 86.6)               79.8 (63.5, 86.7)
 Chrna2                     29               64.9 (52.6, 89.3)               67.4 (51.2, 88.2)               65.8 (43.4, 91)                 69.5 (53.5, 95.6)               72.9 (54.5, 95.9)
 Nkx2                       23               75.0 (59.6, 97.4)               68.7 (60.4, 96.2)               77.8 (58.1, 95.3)               82.9 (68.2, 97.5)               82.8 (68.4, 97.5)
 The single number in each cell is the median. The ﬁrst and third quartiles are in brackets below the median. All Cre lines with ﬁve or more neurons (n) present in the GLIF1 level are included. Some
 neurons have the required stimuli for LIF models but do not have the stimuli required for higher level models. When there are not more than ﬁve neurons in the level, the values are denoted with a NaN.
 Data illustrated in Supplementary Figures 8, 9, and 10




stimuli. (2) The biological effects phenomenologically described                                       times whereas the error in ﬁtting the pre/post-spike voltage did
here by reset rules and the after-spike currents act together to                                       not.
create the voltage waveform of a neuron. Here, we ﬁt the after-                                           Our work uses similar methods to ref. 20 Both studies incor-
spike currents and the reset rules independently on the voltage                                        porate generalizations on the basic LIF model. In addition, both
waveform of a neuron without subtracting out the effect of the                                         studies implement a fast ﬁtting step followed by a slower opti-
other mechanism. Explicitly, when the reset rules in GLIF2 were                                        mization of a variable. However, there are some differences: (1)
calculated, there were certainly after-spike currents (which loosely                                   Here, more complex reset rules are used that map the state of the
represent the summation of the ion-channel effects in biological                                       neuron before the spike to that after. (2) We include a membrane
neurons) present in the data. In addition, the after-spike currents                                    potential-dependent adaptation of threshold. (3) We use expo-
were ﬁt to the observed sub-threshold voltage, which includes the                                      nential basis functions for the time-dependencies of the after-
biological reset rules. (3) Reset rules and after-spike currents exert                                 spike currents. These allow a much sparser representation,
inﬂuence on different time scales. Reset rules have an instanta-                                       essential for clustering, compared to the non parameterized after
neous effect implemented right after a spike (or far away from the                                     spike-current trace composed of wavelets implemented in Poz-
next spike) whereas after-spike currents have multiple time scales                                     zorini et al.20 (4) We use a direct measurement of noise in the
that extend though the sub-threshold portion of the voltage trace                                      membrane potential of a neuron rather than a probabilistic
to the next spike. (4) We only optimize one parameter to the                                           threshold. The exact comparison of performance for models
spike times of the data. More parameters could be optimized to                                         across different publications is difﬁcult because performance is
potentially achieve better spike time performance. However,                                            dependent on the properties of the input currents, i.e., if there are
adding more parameters greatly increases optimization time and                                         large variations in the input current, the capacity to predict the
is more prone to over-ﬁtting. (5) The metrics we used to ﬁt and                                        spiking output is better. We chose to compute the performance
optimize the parameters (linear regression and difference between                                      metrics on stimuli similar to what would be observed in vivo: our
model and data voltage at spike time in the forced spike para-                                         stimuli have a coefﬁcient of variation equal to 0.2 centered
digm) were not our reporting metrics (explained variance, dif-                                         around baselines at 0.75, 1.0, and 1.25 current threshold (rheo-
ference in sub-threshold voltage). The “take home” message here                                        base). The Pozzorini et al.20 stimulus has a variable coefﬁcient of
is that the ability to accurately reproduce spike times is due to the                                  variation centered around a single baseline. As opposed to
complicated interaction of many counteracting mechanisms over                                          comparing models across previous studies, the focus of this study
different time scales.                                                                                 is to apply generalizations of the leaky integrate and ﬁre model to
   The progression of the explained variance for the different                                         a large database of neuronal responses, characterize the models
GLIF levels suggests that after-spike currents are very important                                      associated with a large number of transgenic lines, and demon-
for achieving the spiking behavior of inhibitory neurons, whereas                                      strate how well they describe the spiking responses and dissociate
a combination of after-spike currents and reset rules are necessary                                    between cell types.
to improve the performance of excitatory neurons. In addition,                                            In an attempt to characterize cell types associated with the
incorporating the voltage-activated threshold improves the per-                                        input/output transform measured by electrophysiological
formance of excitatory neurons even more while it does little for                                      experiments, clustering algorithms can be run on a set of elec-
inhibitory models. At all levels, models were able to reproduce the                                    trophysiology features. However, it is not entirely clear which are
spike times of inhibitory neurons better than excitatory neurons.                                      the most important features to consider. An alternative method is
Inhibitory neurons have a more stereotyped relationship between                                        to use the entire spike-train by synthesizing the input/output
voltage before and after a spike, shorter spike cut lengths, and                                       relationship into a model and then performing the clustering on
spike more. The spike cut length and the number of spikes sig-                                         the model parameters. A seemingly intuitive model to use for
niﬁcantly predict a model's capacity to reproduce neuronal spike                                       such a clustering would be a biophysically detailed model, as the

10                                   NATURE COMMUNICATIONS | (2018)9:709                                          | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                                                                                                                                                                                                                                                                                                                                                                     ARTICLE

parameters map well to biological mechanisms. However, one                                                                                                                                                                                                  reproduce spike times of biological data20. Indeed, previous stu-
problem with such models is that they do not provide unique                                                                                                                                                                                                 dies have touched upon the potential for clustering using sim-
solutions: repeated optimization with the same input can lead to                                                                                                                                                                                            pliﬁed models19.
solutions which are far away in parameter space. Thus, another                                                                                                                                                                                                 The unsupervised clusters of the GLIF parameters or the fea-
approach is to use simpler linear models which have both (a)                                                                                                                                                                                                tures extracted from the electrophysiological traces do not per-
unique parameter solutions, and (b) have been shown to                                                                                                                                                                                                      fectly match the transgenic lines. This is not surprising given that

                                                                                                                                           Features                                                                                                                                                                                             Features, no spike-shape parameters

                                                                       Cluster 1                                                                                                                                                                                                                              Cluster 1
                                                               91                                                                                                                                                                                                                                 93
                                                                       Cluster 2                                                                                                                                                                                                                              Cluster 2
                                                                80                                                                                                                                                                                                                                    81
                                                                       Cluster 3                                                                                                                                                                                                                              Cluster 3
                                        94
                                                                       Cluster 4                                                                                                                                                                                      89                                      Cluster 4
                                                                86                                                                                                                                                                                                                                    91
                                                               85
                                                                       Cluster 5                                                                                                                                                                                                                              Cluster 5
                          84                                           Cluster 6                                                                                                                                                                                            90                                Cluster 6
                                                                                                                                                                                                                                                                                                      81
                                                                       Cluster 7                                                                                                                                                                                                                              Cluster 7
                                                                                                                                                                                                                                                                                                 90
                                                  87
                                                                       Cluster 8                                                                                                                                                                                                                              Cluster 8
                                                                89                                                                                                                                                                                          90                                        82
                                                                       Cluster 9                                                                                                                                                                                                                              Cluster 9
                                                          80
                                                                      Cluster 10                                                                                                                                                                                                                             Cluster 10
                     95                                         84
                                                                      Cluster 11                                                                                                                                                                                                                 88          Cluster 11
                                                                                                                                                                                                                                                                                                  82
                                                                      Cluster 12                                                                                                                                                                                                                             Cluster 12
                                                                81                                                                                                                                                                                                                                    83
                                                                      Cluster 13                                                                                                                                                                                           93                                Cluster 13
                                                          90
                                                                      Cluster 14                                                                                                                                                                                                                             Cluster 14
                                                                83                                                                                                                                                                                                                                    82
                                                  96
                                                                      Cluster 15                                                                                                                                                                                                                  93
                                                                                                                                                                                                                                                                                                             Cluster 15
                                                                      Cluster 16                                                                                                                                                                                                                             Cluster 16
                                                                                            Htr3a
                                                                                                     Ndnf
                                                                                                            Vip
                                                                                                                  Sst
                                                                                                                        Pvalb
                                                                                                                                Nkx2−1
                                                                                                                                         Chat
                                                                                                                                                Chrna2
                                                                                                                                                         Cux2
                                                                                                                                                                Nr5a1
                                                                                                                                                                         Scnn1a−Tg2
                                                                                                                                                                                      Scnn1a−Tg3
                                                                                                                                                                                                   Rorb
                                                                                                                                                                                                          Rbp4
                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                               Ctgf




                                                                                                                                                                                                                                                                                                                               Htr3a
                                                                                                                                                                                                                                                                                                                                       Ndnf
                                                                                                                                                                                                                                                                                                                                               Vip
                                                                                                                                                                                                                                                                                                                                                     Sst
                                                                                                                                                                                                                                                                                                                                                           Pvalb
                                                                                                                                                                                                                                                                                                                                                                   Nkx2−1
                                                                                                                                                                                                                                                                                                                                                                            Chat
                                                                                                                                                                                                                                                                                                                                                                                   Chrna2
                                                                                                                                                                                                                                                                                                                                                                                            Cux2
                                                                                                                                                                                                                                                                                                                                                                                                   Nr5a1
                                                                                                                                                                                                                                                                                                                                                                                                           Scnn1a−Tg2
                                                                                                                                                                                                                                                                                                                                                                                                                        Scnn1a−Tg3
                                                                                                                                                                                                                                                                                                                                                                                                                                     Rorb
                                                                                                                                                                                                                                                                                                                                                                                                                                            Rbp4
                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ctgf
                                                                                                                                                GLIF1                                                                                                                                                                                                                              GLIF2

                                                                           Cluster 1                                                                                                                                                                                                                          Cluster 1
                                                                                                                                                                                                                                                                                                      81
                                                               86
                                                                                                                                                                                                                                                                                                              Cluster 2
                                                                           Cluster 2                                                                                                                                                                                                         85
                                                                                                                                                                                                                                                                                                              Cluster 3
                                        88                                                                                                                                                                                                                                                            87
                                                                           Cluster 3                                                                                                                                                                                       91                                 Cluster 4
                                                               81                                                                                                                                                                                                                                             Cluster 5
                                92
                                                                           Cluster 4                                                                                                                                                                                                                  81
                                                                                                                                                                                                                                                                 93                                           Cluster 6

                                                                           Cluster 5                                                                                                                                                                                                                          Cluster 7
                                                                                                                                                                                                                                                                                  92                          Cluster 8
                     93
                                                                           Cluster 6                                                                                                                                                                                                         86               Cluster 9
                                                               84                                                                                                                                                                                           92                                    84
                                                                                                                                                                                                                                                                                                             Cluster 10
                                                                           Cluster 7                                                                                                                                                                                                                  90
                                87
                                                                                                                                                                                                                                                                                                             Cluster 11
                                                                           Cluster 8                                                                                                                                                                                                                         Cluster 12
                                                                                                                                                                                                                                                                                                      83
                                                          90                                                                                                                                                                                                                                                 Cluster 13
                                                                           Cluster 9                                                                                                                                                                                                         89
                                                               88                                                                                                                                                                                                                                            Cluster 14
                                                                                                                                                                                                                                                                                                      89
                                                                       Cluster 10                                                                                                                                                                                                                            Cluster 15
                                                                                            Htr3a
                                                                                                     Ndnf
                                                                                                            Vip
                                                                                                                  Sst
                                                                                                                        Pvalb
                                                                                                                                Nkx2−1
                                                                                                                                         Chat
                                                                                                                                                Chrna2
                                                                                                                                                         Cux2
                                                                                                                                                                Nr5a1
                                                                                                                                                                         Scnn1a−Tg2
                                                                                                                                                                                      Scnn1a−Tg3
                                                                                                                                                                                                   Rorb
                                                                                                                                                                                                          Rbp4
                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                               Ctgf




                                                                                                                                                                                                                                                                                                                               Htr3a
                                                                                                                                                                                                                                                                                                                                       Ndnf
                                                                                                                                                                                                                                                                                                                                               Vip
                                                                                                                                                                                                                                                                                                                                                     Sst
                                                                                                                                                                                                                                                                                                                                                           Pvalb
                                                                                                                                                                                                                                                                                                                                                                   Nkx2−1
                                                                                                                                                                                                                                                                                                                                                                            Chat
                                                                                                                                                                                                                                                                                                                                                                                   Chrna2
                                                                                                                                                                                                                                                                                                                                                                                            Cux2
                                                                                                                                                                                                                                                                                                                                                                                                   Nr5a1
                                                                                                                                                                                                                                                                                                                                                                                                           Scnn1a−Tg2
                                                                                                                                                                                                                                                                                                                                                                                                                        Scnn1a−Tg3
                                                                                                                                                                                                                                                                                                                                                                                                                                     Rorb
                                                                                                                                                                                                                                                                                                                                                                                                                                            Rbp4
                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ctgf
                                                                                                                                                GLIF3                                                                                                                                                                                                                              GLIF4

                                                                           Cluster 1                                                                                                                                                                                                                          Cluster 1
                                                               83                                                                                                                                                                                                                                     87
                                                                           Cluster 2                                                                                                                                                                                                                          Cluster 2
                                                                82                                                                                                                                                                                                                               84
                                                                           Cluster 3                                                                                                                                                                                                                          Cluster 3
                                              87
                                                                           Cluster 4                                                                                                                                                                                                                  88
                                                                                                                                                                                                                                                                                     89
                                                                83                                                                                                                                                                                                                                            Cluster 4
                                                               93          Cluster 5
                               91
                                                                                                                                                                                                                                                                                                              Cluster 5
                                                                           Cluster 6
                                                                                                                                                                                                                                                                                                              Cluster 6
                                                                           Cluster 7                                                                                                                                                                                                                  87
                                                           87              Cluster 8                                                                                                                                                                                                                          Cluster 7
                                                                                                                                                                                                                                                            92                                   91
                                                                82
                                                               83          Cluster 9                                                                                                                                                                                                                          Cluster 8
                                                                                                                                                                                                                                                                                                      82
                                                                      Cluster 10                                                                                                                                                                                                                              Cluster 9
                     92
                                                                      Cluster 11                                                                                                                                                                                                                             Cluster 10
                                                                      Cluster 12                                                                                                                                                                                                                      88
                                              93 80
                                                                                                                                                                                                                                                                 92
                                                                                                                                                                                                                                                                                                  80
                                                                                                                                                                                                                                                                                                             Cluster 11
                                                                      Cluster 13
                                                                80                                                                                                                                                                                                                                           Cluster 12
                                                          89          Cluster 14                                                                                                                                                                                            91
                                                                                                                                                                                                                                                                                                             Cluster 13
                                    92                                Cluster 15                                                                                                                                                                                                                      89
                                                                81
                                                                      Cluster 16                                                                                                                                                                                                                  83
                                                                                                                                                                                                                                                                                                             Cluster 14
                                                                                                                                                                                                                                                                           93
                                                                      Cluster 17                                                                                                                                                                                                                             Cluster 15
                                                                81
                                                                      Cluster 18                                                                                                                                                                                                                             Cluster 16
                                                                                            Htr3a
                                                                                                     Ndnf
                                                                                                            Vip
                                                                                                                  Sst
                                                                                                                        Pvalb
                                                                                                                                Nkx2−1
                                                                                                                                         Chat
                                                                                                                                                Chrna2
                                                                                                                                                         Cux2
                                                                                                                                                                Nr5a1
                                                                                                                                                                         Scnn1a−Tg2
                                                                                                                                                                                      Scnn1a−Tg3
                                                                                                                                                                                                   Rorb
                                                                                                                                                                                                          Rbp4
                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                               Ctgf




                                                                                                                                                                                                                                                                                                                               Htr3a
                                                                                                                                                                                                                                                                                                                                       Ndnf
                                                                                                                                                                                                                                                                                                                                               Vip
                                                                                                                                                                                                                                                                                                                                                     Sst
                                                                                                                                                                                                                                                                                                                                                           Pvalb
                                                                                                                                                                                                                                                                                                                                                                   Nkx2−1
                                                                                                                                                                                                                                                                                                                                                                            Chat
                                                                                                                                                                                                                                                                                                                                                                                   Chrna2
                                                                                                                                                                                                                                                                                                                                                                                            Cux2
                                                                                                                                                                                                                                                                                                                                                                                                   Nr5a1
                                                                                                                                                                                                                                                                                                                                                                                                           Scnn1a−Tg2
                                                                                                                                                                                                                                                                                                                                                                                                                        Scnn1a−Tg3
                                                                                                                                                                                                                                                                                                                                                                                                                                     Rorb
                                                                                                                                                                                                                                                                                                                                                                                                                                            Rbp4
                                                                                                                                                                                                                                                                                                                                                                                                                                                       Ntsr1
                                                                                                                                                                                                                                                                                                                                                                                                                                                               Ctgf




                                                                                       Comparison between model/feature clusters and                                                                                                                                                                                           Comparison between model- and
                                                                                                   Cre line partitioning                                                                                                                                                                                                          feature-based clustering
                                                                                       Adjusted VOI                                                                                                                                                                                                                     Adjusted VOI                                                                                                                      0.3
                                                                                                                                                                                                                                                                                                                        Adjusted Rand index
                                                                                       Adjusted Rand index                                                                                                                     0.2
                                                                                       Adjusted VOI,                                                                                                                                                                                                   2.0
                                                                     1.5               Random feature set                                                                                                                                                                                                                                                                                                                                                 0.25
                                                                                       Adjusted Rand index,
                                                                                       Random feature set

                                                                                                                                                                                                                               0.15
                                     Adjusted VOI score




                                                                                                                                                                                                                                                                                                       1.5                                                                                                                                                0.2
                                                                                                                                                                                                                                      Adjusted Rand index




                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Adjusted Rand index
                                                                                                                                                                                                                                                                            Adjusted VOI score




                                                                     1.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                          0.15
                                                                                                                                                                                                                               0.1
                                                                                                                                                                                                                                                                                                       1.0

                                                                                                                                                                                                                                                                                                                                                                                                                                                          0.1
                                                                     0.5
                                                                                                                                                                                                                               0.05
                                                                                                                                                                                                                                                                                                       0.5
                                                                                                                                                                                                                                                                                                                                                                                                                                                          0.05



                                                                     0.0                                                                                                                                                       0                                                                       0.0                                                                                                                                                0
                                                                               GLIF1



                                                                                                    GLIF2



                                                                                                                        GLIF3



                                                                                                                                                 GLIF4




                                                                                                                                                                        spike−shape



                                                                                                                                                                                                            Features
                                                                                                                                                                        Features, no




                                                                                                                                                                                                                                                                                                                GLIF1




                                                                                                                                                                                                                                                                                                                                       GLIF2




                                                                                                                                                                                                                                                                                                                                                                   GLIF3




                                                                                                                                                                                                                                                                                                                                                                                                   GLIF4




                                                                                                                                                                                                                                                                                                                                                                                                                                        spike−shape
                                                                                                                                                                                                                                                                                                                                                                                                                                        Features, no




                                    # Parameters                               5                    7                   7                       9                        10                                14




NATURE COMMUNICATIONS | (2018)9:709                                                                                                                      | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                                                                                                                                                                                                                                                                 11
ARTICLE                                                                                   NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4


the transgenic lines are known to comprise multiple molecularly                    for how much complexity aids in spike time performance and cell
deﬁned cell types. In addition, it is not known what speciﬁc                       type classiﬁcation.
electrophysiological features are needed to classify cell types.
Nonetheless, we certainly expected and did observe relationships.                  Methods
   GLIF model parameters have a better capacity for differ-                        Model deﬁnitions. We developed ﬁve different GLIF models, each of which
entiating transgenic lines than sub-threshold features designed for                successively incorporates the time evolution of one to ﬁve state variables. For
                                                                                   brevity, here all model level equations are presented together. A separate and
that purpose. The set of 14 electrophysiological features that                     detailed description of the models along with their mathematical equations are
include features dependent on spike shape, perform similarly to                    available in the “Model deﬁnitions” section of the Supplementary Methods.
the GLIF4 parameters we use here, at differentiating transgenic                        The set of ﬁve state variables X ¼ fVðtÞ; Θs ðtÞ; Iðj¼1;2Þ ðtÞ; ΘV ðtÞg represent the
lines (the full set of features perform slightly worse than GLIF4                  neuronal membrane potential, the spike-dependent component of the threshold,
                                                                                   two after-spike currents and the membrane potential-dependent component of the
when differentiated by the iterative binary clustering and perform                 threshold, respectively. Figure 1a illustrates the iteration between the state variables
slightly better when differentiated by afﬁnity propagation). When                  in the model equations. Table 1 contains a summary of the parameters and
the spike-shape features are removed, their ability to classify                    variables. It is assumed that these state variables evolve in a linear manner between
transgenic lines drops below the ability of GLIF4. This suggests                   spikes:
that aspects of spike shape are helpful for transgenic line classi-                                                                                     !
                                                                                                               1            X           1
ﬁcation30 when clustering electrophysiological features alone.                                         V′ðtÞ ¼
                                                                                                               C
                                                                                                                   Ie ðtÞ þ     Ij ðtÞ  ðVðtÞ  EL Þ ;
                                                                                                                                        R
                                                                                                                                                                         ð1Þ
                                                                                                                             j
When including spike-shape features along with GLIF3 and GLIF4
parameters in classiﬁcation, any improvement in the ability to
differentiate Cre lines is slight. This suggests that the GLIF3 and                                                    Θ′s ðtÞ ¼ bs Θs ðtÞ;                            ð2Þ
GLIF4 parameters carry much of the information present in this
set of sub-threshold and supra-threshold electrophysiological
                                                                                                                   Ij′ ðtÞ ¼ kj Ij ðtÞ; j ¼ 1; 2;                      ð3Þ
features.
   We did not cluster on all available GLIF parameters as they
were not available for all 645 cells. It is likely that incorporating                                       Θ′v ðtÞ ¼ av ðVðtÞ  EL Þ  bv Θv ðtÞ;                      ð4Þ
the threshold adaptation parameters would further improve
clustering. The GLIF model paradigm is sufﬁciently general that                    where C represents the neurons’s capacitance, R, the membrane resistance, EL, the
additional mechanisms could be added to the GLIF model family.                     resting membrane potential, Ie, the external current, 1=kj , 1=bs , 1=bv are the time
                                                                                   constants of the after-spike currents, spike and voltage dependence of the
For example, a mechanism that accounts for the sharp voltage rise                  threshold, and av couples the membrane potential to the threshold.
at spike initiation23 incorporated by the adaptive exponential                         If VðtÞ>Θv ðtÞ þ Θs ðtÞ þ Θ1 , a spike is generated. After a refractory period, δt,
integrate and ﬁre model31 could further raise the clustering                       the state variables are updated with a linear dependence on the state before the
capabilities of GLIF parameters.                                                   spike:
   As with all abstractions, there are limitations to our models: the                                     Vðtþ Þ      EL þ fv ´ ðVðt Þ  EL Þ  δV;                    ð5Þ
traces which are reproduced are coming from a current injection
into the soma of the neuron under stereotyped recording con-
                                                                                                                   Θs ðtþ Þ       Θs ðt Þ þ δΘs ;                      ð6Þ
ditions. We try to keep the statistics of the test stimulus similar to
in vivo patch clamp currents, but in vivo, additional large sources
of variability will occur from stochastic transmission at synapses,                                                Ij ðtþ Þ   fj ´ Ij ðt Þ þ δIj ;                     ð7Þ
complex dendritic integration, neuromodulation, etc. These
mechanisms, which are necessary for exact integration of single-
                                                                                                                       Θv ðtþ Þ      Θv ðt Þ:                          ð8Þ
neuron models into systems models are beyond the scope of the
current study.                                                                     Where t+ and t− represent the time just after and before a spike, respectively. fv, and
   For any study, the best model to use will depend on the                         δV, are the slope and intercept of the linear relationship of the voltage before and
question at hand. Currently, it is unknown what level of spike                     after a spike (see Supplementary Fig. 1). δΘs is the amplitude of the spike-induced
precision will be needed in network models. However, as the                        threshold after spiking. fj, is a fraction of current implemented after a spike; here it
                                                                                   is always set to 1. δIj, is the amplitude of the spike-induced currents.
brain has evolved a diversity of cell types, it is likely cell type-                    The 1D model, GLIF1, is represented by equation 1, with a simple reset and
speciﬁc models will be necessary to model brain computation. We                    Ij ðtÞ = 0 for all j. GLIF2 adds Θs and the more complex reset rules (Eqs. 5 and 6).
hope that this study along with our corresponding publicly                         GLIF3 uses membrane potential and two spike-induced currents, Ij ðtÞ in Eq. 1, and
available database of models will be a useful resource for the                     reset rules deﬁned by Eq. 7. GLIF4 uses membrane potential, spike-induced
                                                                                   threshold dependence and after spike currents, whereas GLIF5 uses all the variables
community by providing both optimized models and an intuition                      described.




Fig. 6 We identify discrete putative clusters using an iterative binary clustering approach on 645 cells. The top six panels show the summary of clusters
obtained by iterative binary clustering using electrophysiological features extracted from the traces and GLIF model parameters. In every panel, each row
represents a cluster, and each column a transgenic line. The size of the circle indicates the fraction of cells from a given transgenic line falling into a speciﬁc
cluster (such that the sum of fractions in a column add up to 1). The dendrogram on the y-axis shows the iterative binary splitting into clusters using the
algorithm explained in the text. For each intermediate node, a support vector machine was trained on half the cells at that node and used to classify the
remaining cells. The number at each node indicates the minimum percentage of test cells correctly classiﬁed over 100 iterations of randomly selected
training and test cells. Clustering based on features and using the GLIF3 and GLIF4 model parameters shows separation among lines labeling inhibitory and
excitatory cells. In addition, transgenic Cre lines marking Pvalb+, Ntsr1+, Nr5a1+, and Ctgf+cells tend to segregate into distinct clusters. The bottom two
panels show two measures of overall clustering similarity: the adjusted Rand index (ARI) in red, and the adjusted variation of information (AVOI) in black.
The bottom left panel shows similarity between each set of clusters and the transgenic lines. The bottom right panel shows similarity between each set of
clusters and the clusters obtained using the features. An ARI of 1 indicates perfect agreement between partitions, whereas 0 or negative values indicate
chance levels of agreement. A positive value of the AVOI indicates agreement between partitions that is better than chance (which is indicated by 0). The
gray and pink traces in these two panels show the AVOI and ARI values, respectively, for random subsets of the features containing the same number of
parameters as each of the four GLIF models

12                            NATURE COMMUNICATIONS | (2018)9:709                           | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ARTICLE

Stimulus. We designed a set of four different types of stimuli for ﬁtting and testing                                                                                                                                                                                                   The ﬁrst type of stimulus we used were very short (3 ms) square pulses of
parameters of our GLIF models (Fig. 2). This set of stimuli is part of a much larger                                                                                                                                                                                                multiple amplitudes to assess the threshold of a neuron. The minimal voltage at
electrophysiological stimulation protocol which are the subject of different studies.                                                                                                                                                                                               which the neuron ﬁres a spike in response to a short current pulse is deﬁned as the
Details of the stimuli described here and the other stimuli of the Allen Cell Type                                                                                                                                                                                                  instantaneous threshold, Θ∞. This parameter is later optimized in the post hoc
Database can be found at ref. 24                                                                                                                                                                                                                                                    procedure (see sections, “Fitting and post hoc optimization of instantaneous


                                                                                                                         GLIF1                                                                                                                                                                                                                                                                               GLIF2
                                                     Cluster 1                                                                                                                                                                                                                                                               Cluster 1

                          86                                                                                                                                                                                                                                                                                          86
                                                     Cluster 2                                                                                                                                                                                                                                                               Cluster 2
                                                                                                                                                                                                                                                                                                                       86
                           86
                                                     Cluster 3                                                                                                                                                                                                                                                               Cluster 3
                               82                                                                                                                                                                                                                                                         90
                    89                               Cluster 4                                                                                                                                                                                                                                                               Cluster 4

                                                     Cluster 5                                                                                                                                                                                                                                                               Cluster 5
                                                                                                                                                                                                                                                                                                90                     85
                           81
                                                     Cluster 6                                                                                                                                                                                                                                                               Cluster 6
                               82
                                                     Cluster 7                                                                                                                                                                                                                                    85                         Cluster 7
             92                                                                                                                                                                                                                                                                                                        85
                                                     Cluster 8                                                                                                                                                                                                          93                                                   Cluster 8
                                                                                                                                                                                                                                                                                                                      82
                          87                         Cluster 9                                                                                                                                                                                                                                                               Cluster 9
                           86
                                               Cluster 10                                                                                                                                                                                                                                                                   Cluster 10
                               81
                    96                         Cluster 11                                                                                                                                                                                                                                                   89              Cluster 11
                                                                                                                                                                                                                                                                                                                       86
                                               Cluster 12                                                                                                                                                                                                                                                                   Cluster 12
                                                                                                                                                                                                                                                                                                                      84
                           88                                                                                                                                                                                                                                                                     93
                                               Cluster 13                                                                                                                                                                                                                                                                   Cluster 13
                               82
                                               Cluster 14                                                                                                                                                                                                                                                                   Cluster 14
                                                                   Htr3a
                                                                             Ndnf
                                                                                    Vip
                                                                                             Sst
                                                                                                     Pvalb
                                                                                                              Nkx2−1
                                                                                                                       Chat
                                                                                                                              Chrna2
                                                                                                                                       Cux2
                                                                                                                                                    Nr5a1
                                                                                                                                                            Scnn1a−Tg2
                                                                                                                                                                                Scnn1a−Tg3
                                                                                                                                                                                                   Rorb
                                                                                                                                                                                                                 Rbp4
                                                                                                                                                                                                                                Ntsr1
                                                                                                                                                                                                                                        Ctgf




                                                                                                                                                                                                                                                                                                                                            Htr3a
                                                                                                                                                                                                                                                                                                                                                      Ndnf
                                                                                                                                                                                                                                                                                                                                                             Vip
                                                                                                                                                                                                                                                                                                                                                                      Sst
                                                                                                                                                                                                                                                                                                                                                                            Pvalb
                                                                                                                                                                                                                                                                                                                                                                                     Nkx2−1
                                                                                                                                                                                                                                                                                                                                                                                                 Chat
                                                                                                                                                                                                                                                                                                                                                                                                        Chrna2
                                                                                                                                                                                                                                                                                                                                                                                                                 Cux2
                                                                                                                                                                                                                                                                                                                                                                                                                                     Nr5a1
                                                                                                                                                                                                                                                                                                                                                                                                                                             Scnn1a−Tg2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Scnn1a−Tg3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Rorb
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Rbp4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Ntsr1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Ctgf
                                                                                                                         GLIF3                                                                                                                                                                                                                                                                               GLIF4
                                                     Cluster 1                                                                                                                                                                                                                                                               Cluster 1

                           80                                                                                                                                                                                                                                                                                         84
                                                     Cluster 2                                                                                                                                                                                                                                                               Cluster 2
                                                                                                                                                                                                                                                                                                                       82
                               80
                          81                                                                                                                                                                                                                                                                           87                    Cluster 3
                                                     Cluster 3
                                                                                                                                                                                                                                                                                                                             Cluster 4
                                                     Cluster 4                                                                                                                                                                                                                                                         89
                     82
                                                                                                                                                                                                                                                                                                                             Cluster 5
                                                     Cluster 5                                                                                                                                                                                                                             90
                                                                                                                                                                                                                                                                                                                             Cluster 6
                               83
                                                     Cluster 6                                                                                                                                                                                                                                                        90
                                                                                                                                                                                                                                                                                                                             Cluster 7
                                                                                                                                                                                                                                                                                                                       84
                                                     Cluster 7                                                                                                                                                                                                                                                   89          Cluster 8
             95
                               85
                                                     Cluster 8                                                                                                                                                                                                                                                               Cluster 9
                                                                                                                                                                                                                                                                           93
                          90
                                                                                                                                                                                                                                                                                                                            Cluster 10
                                                     Cluster 9                                                                                                                                                                                                                                                         80
                               88                                                                                                                                                                                                                                                                                           Cluster 11
                    96                           Cluster 10                                                                                                                                                                                                                                                      91
                                                                                                                                                                                                                                                                                                                            Cluster 12
                                                 Cluster 11                                                                                                                                                                                                                                                            81
                                                                                                                                                                                                                                                                                                91                          Cluster 13
                           88
                                                 Cluster 12                                                                                                                                                                                                                                                                 Cluster 14
                               81                                                                                                                                                                                                                                                                                      84
                                                 Cluster 13                                                                                                                                                                                                                                                                 Cluster 15
                                                                                                                                                                                                                                                                                                                                            Htr3a
                                                                                                                                                                                                                                                                                                                                                      Ndnf
                                                                                                                                                                                                                                                                                                                                                             Vip
                                                                                                                                                                                                                                                                                                                                                                      Sst
                                                                                                                                                                                                                                                                                                                                                                            Pvalb
                                                                                                                                                                                                                                                                                                                                                                                     Nkx2−1
                                                                                                                                                                                                                                                                                                                                                                                                Chat
                                                                                                                                                                                                                                                                                                                                                                                                        Chrna2
                                                                                                                                                                                                                                                                                                                                                                                                                 Cux2
                                                                                                                                                                                                                                                                                                                                                                                                                                     Nr5a1
                                                                                                                                                                                                                                                                                                                                                                                                                                             Scnn1a−Tg2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Scnn1a−Tg3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Rorb
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Rbp4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Ntsr1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Ctgf
                                                                    Htr3a
                                                                             Ndnf
                                                                                       Vip
                                                                                             Sst
                                                                                                     Pvalb
                                                                                                              Nkx2−1
                                                                                                                       Chat
                                                                                                                              Chrna2
                                                                                                                                       Cux2
                                                                                                                                                    Nr5a1
                                                                                                                                                            Scnn1a−Tg2
                                                                                                                                                                                Scnn1a−Tg3
                                                                                                                                                                                                   Rorb
                                                                                                                                                                                                                 Rbp4
                                                                                                                                                                                                                                Ntsr1
                                                                                                                                                                                                                                        Ctgf




                                                                   Comparison between model/feature clusters                                                                                                                                                                                                                                             Comparison between model-
                                                                           and Cre line partitioning                                                                                                                                                                                                                                                     and feature-based clustering
                                                                            Adjusted VOI                                                                                                                                                                                                                                                  Adjusted VOI                                                                                                                                                                               0.3
                                                                            Adjusted Rand index                                                                                                                                                                                                                                           Adjusted Rand index
                                                                                                                                                                                                                                                             0.2
                                                                                                                                                                                                                                                                                                                           2.0
                                                       1.5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0.25

                                                                                                                                                                                                                                                             0.15
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Adjusted Rand index
                                                                                                                                                                                                                                                                    Adjusted Rand index



                                                                                                                                                                                                                                                                                                 Adjusted VOI score




                                                                                                                                                                                                                                                                                                                           1.5                                                                                                                                                                                                       0.2
                                Adjusted VOI score




                                                       1.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0.15
                                                                                                                                                                                                                                                             0.1
                                                                                                                                                                                                                                                                                                                           1.0

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0.1
                                                       0.5
                                                                                                                                                                                                                                                             0.05                                                          0.5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0.05


                                                       0.0                                                                                                                                                                                                   0                                                             0.0                                                                                                                                                                                                       0
                                                                 GLIF1

                                                                               GLIF2

                                                                                             GLIF3

                                                                                                             GLIF4
                                                                                                                       Features, no
                                                                                                                       spike−shape
                                                                                                                                         Features

                                                                                                                                                            GLIF1+spike shape

                                                                                                                                                                                             GLIF2+spike shape

                                                                                                                                                                                                                    GLIF3+spike shape

                                                                                                                                                                                                                                         GLIF4+spike shape




                                                                                                                                                                                                                                                                                                                                  GLIF1

                                                                                                                                                                                                                                                                                                                                              GLIF2

                                                                                                                                                                                                                                                                                                                                                              GLIF3

                                                                                                                                                                                                                                                                                                                                                                             GLIF4
                                                                                                                                                                                                                                                                                                                                                                                              Features, no
                                                                                                                                                                                                                                                                                                                                                                                              spike−shape
                                                                                                                                                                                                                                                                                                                                                                                                                 GLIF1+spike shape

                                                                                                                                                                                                                                                                                                                                                                                                                                              GLIF2+spike shape

                                                                                                                                                                                                                                                                                                                                                                                                                                                                               GLIF3+spike shape

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          GLIF4+spike shape




Fig. 7 Iterative binary splitting clustering obtained from using GLIF model parameters plus spike-shape-related feature parameters. The top four panels
show cluster versus Cre line composition, similar to Fig. 6. The bottom two panels show the adjusted variation of information metric and the adjusted Rand
index for the GLIF model-derived clusters with and without the spike-shape parameters

NATURE COMMUNICATIONS | (2018)9:709                                                                                                                                         | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                                                                                                                                                                                                                                                                                                               13
ARTICLE                                                                                         NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4


threshold in the main text”, and “Post hoc optimization” in the Supplementary             traces from 10% of the maximum voltage deﬂection to the maximum voltage
Methods).                                                                                 deﬂection.
    The most substantial type of stimulus we used, consists of noise stimuli. This            Input resistance (Ri): The input resistance was calculated by ﬁrst measuring the
noise was created to have a coefﬁcient of variation of 0.2 (similar to in vivo patch      peak voltage deﬂection evoked by one-second current steps with amplitudes from
clamp recordings) at three different base amplitudes: one sub-threshold, one              −10 pA to −90 pA (20 pA interval), then taking the slope of a linear ﬁt to those
peri-threshold and one supra-threshold to explore different parameter regimes.            deﬂections versus the respective stimulus amplitudes.
Each amplitude is given for 3 s with a 5 s break in between to allow the neuron to            Resting potential (Vrest): The resting potential was calculated by averaging
settle to a rest state. Using stimuli with highly varied structure is important. Not      the pre-stimulus membrane potential across all one-second current step
only does it allow the model to explore the parameter space but it is more                responses.
realistic to what a neuron actually experiences in vivo. Solely using traditional             Threshold current (Ithresh): The threshold current was the minimum
simple stimuli, such as square pulses, would present only a small subset of               amplitude of a one-second current step that evoked at least one action
possible histories (both spiking and sub-threshold) and bias the data set to a            potential.
non-physiological regime. Within this noise data we have two different complete               Action potential threshold (Vthresh): The action potential threshold was deﬁned
sets of noise which we refer to as noise 1 and noise 2. The noise 1 and noise             as the membrane potential before the action potential peak where the dV/dt was
2 stimuli have the same statistics but were created with a different random seed.         5% of the maximum dV/dt averaged across all spikes evoked by the stimulus.
We used noise 1 data to ﬁt the model and noise 2 as “hold out” test data to ensure            Action potential peak (Vpeak): The action potential peak was deﬁned as the
we have not over ﬁt our model. Both the noise 1 and noise 2 stimuli are repeated          maximum membrane potential reached during an action potential.
at least twice to characterize how consistently the biological neuron ﬁres at the             Action potential fast trough (Vfasttrough): The action potential fast trough was
same time for a repeated stimulus.                                                        deﬁned as the minimum value of the membrane potential within 5 ms after the
    The third type of stimulus is a (3 s) sub-threshold long square pulse just below      action potential peak.
rheobase given to characterize the intrinsic noise in the neuronal membrane near              Action potential trough (Vtrough): The action potential fast trough was deﬁned
threshold (please see “Objective function: maximum likelihood based on internal           as the minimum value of the membrane potential before the next spike (or end of
noise (MLIN)” in the Supplementary Methods and Supplementary Fig. 5).                     the stimulus interval).
    Finally, a series of short square pulses at different frequencies, referred to as a       Upstroke/downstroke ratio (up:downstroke): The ratio between the absolutes
“triple short square” (Supplementary Fig. 3), are used to characterize the spike-         values of the action potential peak upstroke (i.e., maximum dV/dt value before the
induced changes in threshold in the absence of additional membrane potential-             peak) and action potential peak downstroke (i.e., minimum dV/dt value after the
induced changes (such as the voltage-induced changes in threshold modeled in              peak). Here, the upstroke/downstroke ratio was separately measured on action
GLIF5). This stimulus is necessary to ﬁt all models with a spike component of             potentials evoked by a one-second (long square) current step and a 3 ms (short
threshold, i.e., GLIF2, GLIF4, and GLIF5. Due to experimental constraints                 square) current step.
independent of this study, this triple short square stimulus was only played to               Sag: The sag was calculated as the difference between the minimum membrane
approximately half the neurons. This is why there are many fewer GLIF2, GLIF4,            potential value reached during a hyperpolarizing one-second current step and the
and GLIF5 models available.                                                               steady-state membrane potential during that step, divided by the difference
                                                                                          between the minimum membrane potential value reached during the step and the
                                                                                          baseline membrane potential. The sag was calculated on the step where the
Model exclusion criteria. Only transgenic lines which contained more than ﬁve             minimum membrane potential was closest to a value of −100 mV.
neurons and had the necessary data to create a basic GLIF1 model described in                 f–I curve slope: The f–I curve was calculated by measuring the average ﬁring
“Stimulus” section, were included in this study. In addition, models which had            rate during one-second current steps versus the stimulus amplitude. The supra-
biologically unrealistic parameter values after ﬁtting, or neurons that had an            threshold part of the curve was ﬁt with a line, and the slope was taken from that
explained variance ratio value less than 20% for one model on the training data set       linear ﬁt.
(noise 1) were eliminated (please see the “Exclusion criteria” section in the Sup-            Latency to the ﬁrst action potential (latency): Latency was calculated as the
plementary Methods for a detailed explanation of excluded data). Overall, a total of      interval between the start of the stimulus and the time of the ﬁrst spike evoked by
645 neurons from 16 transgenic lines met the criteria for ﬁtting the GLIF1 and            the stimulus.
GLIF3 models. As mentioned in the “Stimulus” section, only some neurons were                  Maximum burst index (max. burst index): If a burst was identiﬁed during a
given the stimulus needed to create GLIF2, GLIF4, and GLIF5 models. 254 neurons           response, a burst index was calculated as the difference between the maximum
met the additional requirements for models with reset rules (GLIF2 and GLIF4) and         instantaneous ﬁring rate inside the burst and the maximum instantaneous ﬁring
253 neurons met all the criteria for a GIF5 model.                                        rate outside the burst, normalized by their sum. Bursts were identiﬁed as a
                                                                                          change in the character of the voltage trajectory during the interspike interval
                                                                                          (e.g., changing from a “direct” trajectory, where the membrane potential was
Fitting and post hoc optimization of instantaneous threshold, Θ∞. Similar to              always increasing after a spike, to a “delay” trajectory, where the membrane
ref.20, GLIF model ﬁtting is achieved in two steps. In the ﬁrst step, parameters          potential ﬁrst hyperpolarized, then depolarized after a spike). If no burst was
are ﬁt directly from the electrophysiological data using linear methods described         detected, the index was zero. The maximum index reported here was the
in detail in the “Parameter ﬁtting and distributions” section of the Supplemen-           maximum across all the supra-threshold responses evoked by depolarizing one-
tary Methods: EL from the mean membrane potential at rest, R, and C from                  second current steps.
ﬁtting the membrane potential during a sub-threshold noise stimulus, δIj ; kj
from ﬁtting the membrane potential between spikes during a supra-threshold
stimulus, fv ; δt; δV relating the potential before and after a spike during the noise    Data availability. All data are publicly and freely available on the Allen Cell Type
stimulus, bs ; δΘS from the potential of subsequent spikes during a series of brief       Database at http://celltypes.brain-map.org. Analysis code is available in the Allen
square pulses, av and bv from the potential of subsequent spikes during the               Institute Github repository at https://github.com/AllenInstitute/
supra-threshold noise stimulus. Slices from this parameter space are shown in             GLIF_Teeter_et_al_2018. Code for the creation of the pink noise stimulus can be
Fig. 3a–f.                                                                                found at https://github.com/AllenInstitute/ephys_pink_noise.
    In the second step, the instantaneous threshold, Θ∞, was optimized to ﬁt the
probability of a neuron model reproducing observed spike times. This is realized          Received: 6 January 2017 Accepted: 20 December 2017
using a non-linear Nelder Mead optimization strategy as described in detail in the
“Post hoc optimization” section of the Supplementary Methods. Θ∞ represents the
threshold of a neuron when it is stimulated from rest. Any parameter, or
combination of parameters, could have been chosen for additional optimization.
However, the time needed to optimize more than one parameter is prohibitive. Θ∞
was chosen for further optimization because it is represents the overall excitability
of a neuron and therefore is likely to be the best parameter to counteract any error      References
in the ﬁtting or the inherent error introduced by simplifying any complex system to       1. Allen Institute for Brain Science. Allen Cell Types Database. http://celltypes.
a simple model. The changes in instantaneous threshold, θ∞, with optimization                brain-map.org/ (2016).
subsection of the Supplementary Methods and Supplementary Fig. 7 discuss how              2. Allen Institute for Brain Science. Allen Cell Types Database, Technical White
Θ∞ is altered by optimization.                                                               Paper: Allen Mouse Common Coordinate Framework. http://help.brain-map.
                                                                                             org/display/celltypes/Documentation?preview=/8323525/10813529/
                                                                                             CellTypes_Ephys_Overview.pdf (2016).
Electrophysiological features. We use a set of 14 electrophysiological features to        3. Koch, C. Biophysics of Computation: Information Processing in Single Neurons
perform clustering. Detailed explanations of these features can be found at ref. 24.         (Oxford University Press, New York, NY, 2004).
Here, we brieﬂy describe them below.                                                      4. Herz, A. V., Gollisch, T., Machens, C. K. & Jaeger, D. Modeling single-neuron
   Membrane time constant (τm): The membrane time constant of the cell was                   dynamics and computations: a balance of detail and abstraction. Science 314,
calculated by averaging the time constants of single-exponential ﬁts to                      80–85 (2006).
hyperpolarizing responses evoked by one-second current steps with
amplitudes from −10 pA to −90 pA (20 pA interval). Fits were performed on the

14                               NATURE COMMUNICATIONS | (2018)9:709                               | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications
NATURE COMMUNICATIONS | DOI: 10.1038/s41467-017-02717-4                                                                                                        ARTICLE

5. Gerstner, W. & Naud, R. How good are neuron models? Science 326, 379–380              31. Brette, R. & Gerstner, W. Adaptive exponential integrate-and-ﬁre model
    (2009).                                                                                  as an effective description of neuronal activity. J. Neurophysiol. 94, 3637–3642
6. Hodgkin, A. L. & Huxley, A. F. A quantitative description of membrane current             (2005).
    and its application to conduction and excitation in nerve. J. Physiol. 117, 500
    (1952).
7. Hay, E., Hill, S., Schürmann, F., Markram, H. & Segev, I. Models of neocortical
                                                                                         Acknowledgements
                                                                                         The authors thank the Allen Institute founder, Paul G. Allen, for his vision, encour-
    layer 5b pyramidal cells capturing a wide range of dendritic and perisomatic
                                                                                         agement, and support. We thank the following people for their contributions to the
    active properties. PLoS Comput. Biol. 7, e1002107 (2011).
                                                                                         work enabling our project: Lydia Ng for technology team leadership, Amy Bernard
8. Gouwens, N. et al. Systematic generation of biophysically detailed models for
                                                                                         and John Phillips for data production team leadership, and Susan Sunkin for program
    diverse cortical neuron types. Nat. Commun. https://doi.org/10.1038/s41467-
                                                                                         and project management support. We thank all those on the data production and
    017-02718-3 (2018).
                                                                                         technology teams who helped to collect, curate, quality control and make the data
9. Prinz, A. A., Billimoria, C. P. & Marder, E. Alternative to hand-tuning
                                                                                         publicly available.
    conductance-based models: construction and analysis of databases of model
    neurons. J. Neurophysiol. 90, 3998–4015 (2003).
10. Markram, H. et al. Reconstruction and simulation of neocortical microcircuitry.      Author contributions
    Cell 163, 456–492 (2015).                                                            C.T. developed the project, created and implemented the ﬁtting, optimization, pipeline
11. Gollisch, T. & Meister, M. Eye smarter than scientists believed: neural              and analysis codes, developed the algorithms, preformed the mathematical deriva-
    computations in circuits of the retina. Neuron 65, 150–164 (2010).                   tions, developed and programmed the experimental stimuli, and wrote, edited and is
12. Potjans, T. C. & Diesmann, M. The cell-type speciﬁc cortical microcircuit:           responsible for all subjects of the manuscript. R.I. performed mathematical deriva-
    relating structure and activity in a full-scale spiking network model. Cereb.        tions, developed and created the code for the generalized linear model (GLM) used in
    Cortex 24, 785 (2014).                                                               ﬁtting, developed the experimental pink noise stimuli, and wrote and edited the GLM
13. Lapicque, L. Recherches quantitatives sur l’excitation electrique des nerfs          subject. V.M. is responsible for the intellectual and algorithm development as well as
    traitée comme une polarization. J. De. Physiol. Et. Pathol. Gen. 9, 620–635          code implementation, writing, and editing of the clustering analyses. N.G. is
    (1907).                                                                              responsible for the conceptualization, algorithm development, code implementation,
14. Izhikevich, E. M. Which model to use for cortical spiking neurons. IEEE Trans.       and writing and editing of the electrophysiological feature extraction analyses. D.F.
    Neural Netw. Learn. Syst. 15, 1063–1070 (2004).                                      developed, implemented, and deployed the model pipeline. J.B. was the manager of
15. Mihalas, S. & Niebur, E. A generalized linear integrate-and-ﬁre neural model         electrophysiological pipeline data collection and wrote and edited the electro-
    produces diverse spiking behaviors. Neural Comput. 21, 704–718 (2009).               physicological and cre-line subjects. A.S. was responsible for data curation and public
16. Paninski, L., Pillow, J. W. & Simoncelli, E. P. Maximum likelihood estimation        release. N.C. time-optimizated the post hoc optimization algorithm. H.Z. conceived
    of a stochastic integrate-and-ﬁre neural encoding model. Neural Comput. 16,          and managed electrophysiological data production pipeline. M.H. directed the pri-
    2533–2561 (2004).                                                                    mary group conducting this research. C.K. initiated the project, provided overall
17. Rossant, C., Goodman, D. F., Platkiewicz, J. & Brette, R. Automatic ﬁtting of        scientiﬁc guidance and edited of all subjects of the manuscript. S.M. conceived and
    spiking neuron models to electrophysiological recordings. Front. Neuroinform.        developed the modeling project, created the models, performed mathematical deri-
    4, 2 (2010).                                                                         vations, provided scientiﬁc guidance, conceptualized and developed the experimental
18. Dong, Y., Mihalas, S., Russell, A., Etienne-Cummings, R. & Niebur, E.                stimuli, and wrote, edited, and is responsible for all subjects of the manuscript.
    Estimating parameters of generalized integrate-and-ﬁre neurons from the
    maximum likelihood of spike trains. Neural Comput. 23, 2833–2867
    (2011).                                                                              Additional information
19. Mensi, S. et al. Parameter extraction and classiﬁcation of three cortical neuron     Supplementary Information accompanies this paper at https://doi.org/10.1038/s41467-
    types reveals two distinct adaptation mechanisms. J. Neurophysiol. 107,              017-02717-4.
    1756–1775 (2012).
20. Pozzorini, C. et al. Automated high-throughput characterization of single            Competing interests: The authors declare no competing ﬁnancial interests.
    neurons by means of simpliﬁed spiking models. PLoS Comput. Biol. 11,
    e1004275 (2015).                                                                     Reprints and permission information is available online at http://npg.nature.com/
21. Izhikevich, E. M. et al. Simple model of spiking neurons. IEEE Trans. Neural         reprintsandpermissions/
    Netw. Learn. Syst. 14, 1569–1572 (2003).
22. Izhikevich, E. M. Dynamical Systems in Neuroscience (MIT Press, Cambridge,           Publisher's note: Springer Nature remains neutral with regard to jurisdictional claims in
    MA, 2007).                                                                           published maps and institutional afﬁliations.
23. Badel, L. et al. Dynamic I-V curves are reliable predictors of naturalistic
    pyramidal-neuron voltage traces. J. Neurophysiol. 99, 656–666 (2008).
24. Allen Institute for Brain Science. Allen Cell Types Database, Technical White
    Paper: Electrophysiology. http://help.brain-map.org/display/celltypes/                                 Open Access This article is licensed under a Creative Commons
    Documentation?preview=/8323525/10813529/CellTypes_Ephys_Overview.pdf                                   Attribution 4.0 International License, which permits use, sharing,
    (2016).                                                                              adaptation, distribution and reproduction in any medium or format, as long as you give
25. Tasic, B. et al. Adult mouse cortical cell taxonomy revealed by single cell          appropriate credit to the original author(s) and the source, provide a link to the Creative
    transcriptomics. Nat. Neurosci. 19, 335–346 (2016).                                  Commons license, and indicate if changes were made. The images or other third party
26. Frey, B. J. & Dueck, D. Clustering by passing messages between data points.          material in this article are included in the article’s Creative Commons license, unless
    Science 315, 972–976 (2007).                                                         indicated otherwise in a credit line to the material. If material is not included in the
27. Rand, W. Objective criteria for the evaluation of clustering methods. J. Am.         article’s Creative Commons license and your intended use is not permitted by statutory
    Stat. Assoc. 66, 846–850 (1971).                                                     regulation or exceeds the permitted use, you will need to obtain permission directly from
28. Meila, M. Comparing clusterings by the variation of information. Learn. Theory       the copyright holder. To view a copy of this license, visit http://creativecommons.org/
    Kernel Mach. 1, 173–187 (2003).                                                      licenses/by/4.0/.
29. Allen Institute for Brain Science. Allen Cell Types Database, Technical White
    Paper: Neuronal Models: Biophysical—All Active. http://help.brain-map.org/
    display/celltypes/Documentation?preview=/8323525/10256463/                           © The Author(s) 2018
    BiophysModelAllActive.pdf (2016).
30. Ardid, S. et al. Mapping of functionally characterized cell classes onto canonical
    circuit operations in primate prefrontal cortex. J. Neurosci. 35, 2975–2991
    (2015).




NATURE COMMUNICATIONS | (2018)9:709                               | DOI: 10.1038/s41467-017-02717-4 | www.nature.com/naturecommunications                                       15
